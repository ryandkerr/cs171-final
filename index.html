<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>Electoral Map - Final Project</title>

  <!-- ADD Libraries-->
  <script src="libs/d3/d3.min.js" charset="utf-8"></script>
  <script src="libs/jquery/jquery-2.1.1.min.js" charset="utf-8"></script>
  <script src="libs/bootstrap/js/bootstrap.min.js" charset="utf-8"></script>
  <script src="http://d3js.org/queue.v1.min.js"></script>

  <!--Stylesheets-->
  <link rel="stylesheet" type="text/css" href="libs/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="styles.css">
  <link rel="shortcut icon" href="favicon.ico">
  <style>
  .pathLine { 
    stroke: steelblue;
    stroke-width: 2;
    fill: none;
  }



/*#tooltip {
        position: absolute;
        width: 200px;
        height: auto;
        padding: 10px;
        background-color: white;
        -webkit-border-radius: 10px;
        -moz-border-radius: 10px;
        border-radius: 10px;
        -webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
        -moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
        box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
        pointer-events: none;
}

#tooltip.hidden {
        display: none;
}

#tooltip p {
        margin: 0;
        font-family: sans-serif;
        font-size: 16px;
        line-height: 20px;
}*/

  .axis pathLine,
  .axis line {
    fill: none;
    stroke: grey;
    stroke-width: 0;
    shape-rendering: crispEdges;
  }
  .dotAxis {

  }
  </style>

  <!--Patterns-->
  <!--actually width 4-->
  <svg height="10" width="10" xmlns="http://www.w3.org/2000/svg" version="1.1"> <defs> <pattern id="vertical-stripe-1" patternUnits="userSpaceOnUse" width="10" height="10"> <image xlink:href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPScxMCcgaGVpZ2h0PScxMCc+CiAgPHJlY3Qgd2lkdGg9JzEwJyBoZWlnaHQ9JzEwJyBmaWxsPSd3aGl0ZScgLz4KICA8cmVjdCB4PScwJyB5PScwJyB3aWR0aD0nNCcgaGVpZ2h0PScxMCcgZmlsbD0nYmxhY2snIC8+Cjwvc3ZnPg==" x="0" y="0" width="10" height="10"> </image> </pattern> </defs> </svg>

  <svg height="10" width="10" xmlns="http://www.w3.org/2000/svg" version="1.1"> <defs> <pattern id="horizontal-stripe-1" patternUnits="userSpaceOnUse" width="10" height="10"> <image xlink:href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPScxMCcgaGVpZ2h0PScxMCc+CiAgPHJlY3Qgd2lkdGg9JzEwJyBoZWlnaHQ9JzEwJyBmaWxsPSd3aGl0ZScgLz4KICA8cmVjdCB4PScwJyB5PScwJyB3aWR0aD0nMTAnIGhlaWdodD0nNCcgZmlsbD0nYmxhY2snIC8+Cjwvc3ZnPg==" x="0" y="0" width="10" height="10"> </image> </pattern> </defs> </svg>

  <svg height="10" width="10" xmlns="http://www.w3.org/2000/svg" version="1.1"> <defs> <pattern id="ladder-stripe-1" patternUnits="userSpaceOnUse" width="10" height="10"> <image xlink:href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPScxMCcgaGVpZ2h0PScxMCc+ICA8cmVjdCB3aWR0aD0nMTAnIGhlaWdodD0nMTAnIGZpbGw9J3doaXRlJyAvPiAgPHJlY3QgeD0nMCcgeT0nMCcgd2lkdGg9JzQnIGhlaWdodD0nMTAnIGZpbGw9J2JsYWNrJyAvPiAgPHJlY3QgeD0nMCcgeT0nMCcgd2lkdGg9JzEwJyBoZWlnaHQ9JzQnIGZpbGw9J2JsYWNrJyAvPjwvc3ZnPg==" x="0" y="0" width="10" height="10"> </image> </pattern> </defs> </svg>

  <svg height="10" width="10" xmlns="http://www.w3.org/2000/svg" version="1.1"> <defs> <pattern id="diagonal-stripe-1" patternUnits="userSpaceOnUse" width="10" height="10"> <image xlink:href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPScxMCcgaGVpZ2h0PScxMCc+CiAgPHJlY3Qgd2lkdGg9JzEwJyBoZWlnaHQ9JzEwJyBmaWxsPSdibGFjaycvPgogIDxwYXRoIGQ9J00tMSwxIGwyLC0yCiAgICAgICAgICAgTTAsMTAgbDEwLC0xMAogICAgICAgICAgIE05LDExIGwyLC0yJyBzdHJva2U9J3doaXRlJyBzdHJva2Utd2lkdGg9JzMnLz4KPC9zdmc+" x="0" y="0" width="10" height="10"> </image> </pattern> </defs> </svg>
</head>

<body>
  <div class="container">
    <div class="row"> 
      <h1>American Politics: The Past 100 Years</h1>
      <p>Click a state or drag the slider to explore the data!</p>
    </div>
    
    <div class="row"> 
      <!-- <br> -->
      <!-- <div class="col-md-9" id="col1" style="background-color: #CCF2FF"> -->
      <div class="col-md-9" id="col1">
        <br>
        <!-- Slider here -->
        <form>
          <div>
            <label>Year:</label>
            <label>1912</label>
            <label><input type="range" name="points" min='1912' max='2012' step="4" value="2012" id="year_slider" oninput="CURRENT_YEAR=this.value;
            document.getElementsByClassName('cur')[0].innerHTML = CURRENT_YEAR;
            document.getElementsByClassName('cur')[1].innerHTML = CURRENT_YEAR;
            updateVis();" style="width: 300px"></label><label>2012 (Currently showing <span class="cur">2012</span>)</label>
          </div>
        </form>
        <br>
        
        <div id="choroVis">
          <!-- Main Cloropleth goes here -->
        </div>

      </div>
      
      <!-- <div class="col-md-3" id="presVis" style="background-color: #FFD8D8"> -->
      <div class="col-md-3" id="presVis">
        <h2 class="centered"><span class="cur">2012</span> Election</h2>
        <h4 class="centered">Winners: <span id="winner"></span></h4>
        <h4 class="centered">Runners-up: <span id="loser"></span></h4>
        <h4 class="centered"> <span id="loser2pre"></span><span id="loser2"></span></h4>
      </div>

    <br>State Views (currently showing <span id="clickState">Florida</span>)

    <div class="row">
      <div class="col-md-3" id="stDemographic" style="background-color: #D6FFEB">
        state demographic pie chart 
      </div>
      <div class="col-md-6" id="stParty" style="background-color: #D6FF65">
        state party line graph
      </div>
      <div class="col-md-3" id="stTurnt" style="background-color: #D6FFEB">
        state turnout
      </div>
      <div class="col-md-1" id="stCompare" style="background-color: #D6FFEB">
        state to nation comparison
      </div>
      <!--replicate stParty for national EV and national pct-->
    </div>
  </div>

<script>

// some of this code is taken from these sources:
// http://bl.ocks.org/stevenae/8362841
// http://synthesis.sbecker.net/articles/2012/07/18/learning-d3-part-7-choropleth-maps
// http://bl.ocks.org/mbostock/4060606
// http://bl.ocks.org/mbostock/3887235
// http://bl.ocks.org/mbostock/1346410
// http://bl.ocks.org/mbostock/3151228
// http://bl.ocks.org/d3noob/e34791a32a54e015f57d
// http://bl.ocks.org/mbostock/4403522
// http://bl.ocks.org/d3noob/e1aa61856118edfa624d
// http://bocoup.com/weblog/using-svg-patterns-as-fills/


// helper to find width of element
var getInnerWidth = function(element) {
    var style = window.getComputedStyle(element.node(), null);
    return parseInt(style.getPropertyValue('width'));
};

// global variables
var WIDTH = getInnerWidth(d3.select("#col1")) - 15;
var HEIGHT = 500;
var ELECGLOBAL;
var CURRENT_YEAR = 2012;

// scale to assign margin of victory to bins, which end up as colors
var quantize = d3.scale.quantize()
  .domain([-20, 20])
  .range(["#ff8383", "#ff9e9e", "#ffbaba", "#ffd6d6", "#c2eaff", "#aae2ff", "#91daff", "#75d1ff"]);

var demo_scale = d3.scale.ordinal()
  .domain([0, 1, 2, 3, 4, 5]) 
  .range(["#fae7d0", "#573719", "#c18e74", "#e8cda8", "#ceab67", "#c8aca3"]);

// create svg canvas in chorovis div
var choro_svg = d3.select("#choroVis")
  .append("svg")
  .attr("width", WIDTH)
  .attr("height", HEIGHT);

// create svg canvas for president vis
var pres_svg = d3.select("#presVis")
  .append("svg")
  .attr("width", getInnerWidth(d3.select("#presVis")))
  .attr("height", 450);

// create svg canvas for president vis
var st_demo_svg = d3.select("#stDemographic")
  .append("svg")
  .attr("width", getInnerWidth(d3.select("#stDemographic")))
  .attr("height", 450);

// create svg canvas for stParty vis
var st_party_svg = d3.select("#stParty")
  .append("svg")
  .attr("width", getInnerWidth(d3.select("#stParty")))
  .attr("height", 450);

// create svg canvas for stTurnt vis
var st_turnt_svg = d3.select("#stTurnt")
  .append("svg")
  .attr("width", getInnerWidth(d3.select("#stTurnt")))
  .attr("height", 450);

// create usa projection
var projection = d3.geo.albersUsa()
  .scale(1050);

var path = d3.geo.path()
  .projection(projection);


var state_pattern = choro_svg.append("g")
  .attr("class", "state_pattern")
  .attr("transform", "translate(-40, -10)");

var states = choro_svg.append("g")
  .attr("class", "states")
  .attr("transform", "translate(-40, -10)");



// pie chart functions
var arc = d3.svg.arc()
  .outerRadius(100)
  .innerRadius(70);

var arcInner = d3.svg.arc()
  .outerRadius(53)
  .innerRadius(23);

var arcDemo = d3.svg.arc()
  .outerRadius(100)
  .innerRadius(0);

var pie = d3.layout.pie()
  .sort(null)
  .value(function(d) { return d; });

var arcTween = function (a) {
  var i = d3.interpolate(this._current, a);
  this._current = i(0);
  return function(t) {
    return arc(i(t));
  };
}

var arcTweenInner = function (a) {
  var i = d3.interpolate(this._current, a);
  this._current = i(0);
  return function(t) {
    return arcInner(i(t));
  };
}

// make arc for text
var ev_arc = d3.svg.arc()
  .innerRadius(135)
  .outerRadius(135)
  .startAngle(- Math.PI / 7.3)
  .endAngle(Math.PI / 7.3)

var vote_arc = d3.svg.arc()
  .innerRadius(85)
  .outerRadius(85)
  .startAngle(- Math.PI / 6)
  .endAngle(Math.PI / 6);

// add curved text
pres_svg.append("path")
  .attr("id", "ev_words")
  .attr("d", ev_arc())
  .attr("transform", "translate(130, 120)");

pres_svg.append("path")
  .attr("id", "vote_path")
  .attr("d", vote_arc())
  .attr("transform", "translate(130, 120)");

pres_svg.append("text")
  .attr("x", 8)
  .attr("dy", 28)
  .append("textPath")
  .attr("class", "textpath")
  .attr("xlink:href", "#ev_words")
  .text("Electoral Votes");

pres_svg.append("text")
  .attr("x", 8)
  .attr("dy", 28)
  .append("textPath")
  .attr("class", "textpath")
  .attr("xlink:href", "#vote_path")
  .text("Popular Vote");

// add legend/key for colors
var legend = pres_svg.append("g")
  .attr("transform", "translate(0, 255)");

// "Legend"
legend.append("text")
  .text("Legend")
  .attr("font-size", "28px")
  .attr("text-decoration", "underline")
  .attr("transform", "translate(85, 0)");

// "Margin of Victory - Popular Vote
legend.append("text")
  .text("Margin of Victory - Popular Vote")
  .attr("font-size", "16px")
  .attr("transform", "translate(25, 25)");

// "Party"
legend.append("text")
  .text("Party")
  .attr("text-decoration", "underline")
  .attr("font-size", "14px")
  .attr("transform", "translate(25, 40)");

// Percentages
legend.append("text")
  .text("+20% +10% +5% +2%")
  .attr("text-decoration", "underline")
  .attr("font-size", "14px")
  .attr("transform", "translate(120, 40)");

// Parties
legend.append("text")
  // .text("Democratic\nRepublican\nAmerican Independent\nState's Rights\nProgressive (1924)\nProgressive (1912)")
  .text("Democratic")
  .attr("font-size", "14px")
  .attr("transform", "translate(25, 60)")

legend.append("text")
  .text("Republican")
  .attr("font-size", "14px")
  .attr("transform", "translate(25, 75)");

legend.append("text")
  .text("American")
  .attr("font-size", "14px")
  .attr("transform", "translate(25, 90)");

legend.append("text")
  .text("Independent")
  .attr("font-size", "14px")
  .attr("transform", "translate(35, 105)");


legend.append("text")
  .text("State's Rights")
  .attr("font-size", "14px")
  .attr("transform", "translate(25, 120)");

legend.append("text")
  .text("Progressive")
  .attr("font-size", "14px")
  .attr("transform", "translate(25, 135)")


var addColors = function(y_coord, colors) {
  legend.append("rect")
    .attr("x", 125)
    .attr("y", y_coord - 10)
    .attr("width", 10)
    .attr("height", 10)
    .attr("border-style" , "solid")
    .attr("border-color", "black")
    .attr("stroke-width", "3px")
    .attr("fill", colors[0]);
  
  legend.append("rect")
    .attr("x", 145)
    .attr("y", y_coord - 10)
    .attr("width", 10)
    .attr("height", 10)
    .attr("fill", colors[0]);
  
  legend.append("rect")
    .attr("x", 165)
    .attr("y", y_coord - 10)
    .attr("width", 10)
    .attr("height", 10)
    .attr("fill", colors[0]);
  
  legend.append("rect")
    .attr("x", 185)
    .attr("y", y_coord - 10)
    .attr("width", 10)
    .attr("height", 10)
    .attr("fill", colors[0]);
}

addColors(75, ["#ff9e9e"]);

// initialize state views for FLorida before user clicks anything
var clickState = "Florida";

// updates choropleth with election data
var updateVis = function () {

  // figure out winner for that year
  var gop_ev = 0;
  var dem_ev = 0;
  var amer_ev = 0;
  var badDem_ev = 0;
  var SR_ev = 0;
  var prog_ev = 0;
  var progTwo_ev = 0;
  var gop_votes = 0;
  var dem_votes = 0;
  var badDem_votes = 0;
  var amer_votes = 0;
  var SR_votes = 0;
  var prog_votes = 0;
  var progTwo_votes = 0;
  var gop_pres;
  var dem_pres;
  var third_pres;
  var gop_vice;
  var dem_vice;
  var third_vice;
  var third_name;
  var gop_home;
  var dem_home;
  var third_home;

  ELECGLOBAL.forEach(function(d) {
    if(d.year == CURRENT_YEAR && d.state == "Totals") {
      gop_ev = d.gopEV;
      dem_ev = d.demEV;
      if (d.thirdName == "American Independent") {
        amer_ev = d.thirdEV;
        amer_votes = d.thirdVotes;
      } else if (d.thirdName == "Democratic") {
        badDem_ev = d.thirdEV;
        badDem_votes = d.thirdVotes;
      } else if (d.thirdName == "States' Rights") {
        SR_ev = d.thirdEV;
        SR_votes = d.thirdVotes;
      } else if (d.thirdName == "Progressive (1912)") {
        prog_ev = d.thirdEV;
        prog_votes = d.thirdVotes;
      } else if (d.thirdName == "Progressive (1924)") {
        progTwo_ev = d.thirdEV;
        progTwo_votes = d.thirdVotes;
      }

      gop_votes = d.gopVotes;
      dem_votes = d.demVotes;

      gop_home = d.gopPresBorn;
      dem_home = d.demPresBorn;
      third_home = d.thirdPresBorn;

      gop_pres = d.gopPres;
      dem_pres = d.demPres;
      third_pres = d.thirdPres;
      gop_vice = d.gopVice;
      dem_vice = d.demVice;
      third_vice = d.thirdVice;

      third_name = d.thirdName;
    }
  })
  
  // change names in html
  // if there is no third party
  if (third_pres == "") {
    if(gop_ev > dem_ev) {
      document.getElementById('winner').innerHTML = gop_pres + " and " + gop_vice;
      d3.select("#winner")
        .attr("style", "color:red");
      document.getElementById('loser').innerHTML = dem_pres + " and " + dem_vice;
      d3.select("#loser")
        .attr("style", "color:blue");
      document.getElementById('loser2pre').innerHTML = "";
      document.getElementById('loser2').innerHTML = "";
    } else {
      document.getElementById('winner').innerHTML = dem_pres + " and " + dem_vice;
      d3.select("#winner")
        .attr("style", "color:blue");

      document.getElementById('loser').innerHTML = gop_pres + " and " + gop_vice;
      d3.select("#loser")
        .attr("style", "color:red");
      document.getElementById('loser2pre').innerHTML = "";
      document.getElementById('loser2').innerHTML = "";
    } 
  // if there is a third party
  } else {
    if(gop_ev > dem_ev) {
      document.getElementById('winner').innerHTML = gop_pres + " and " + gop_vice;
      d3.select("#winner")
        .attr("style", "color:red");
      document.getElementById('loser').innerHTML = dem_pres + " and " + dem_vice;
      d3.select("#loser")
        .attr("style", "color:blue");
      document.getElementById('loser2pre').innerHTML = "Second runners-up: ";
      document.getElementById('loser2').innerHTML = third_pres + " and " + third_vice;
      d3.select("#loser2")
        .attr("style", function(d) {
          if (third_name == "Democratic") {
            return "color:blue"
          } else if (third_name == "American Independent") {
            return "color:purple"
          } else if (third_name == "Progressive (1912)") {
            return "color:orange"
          } else if (third_name == "Progressive (1924)") {
            return "color:green"
          } else if (third_name == "States' Rights") {
            return "color:#663300"
          }
        });
    } else {
      document.getElementById('winner').innerHTML = dem_pres + " and " + dem_vice;
      d3.select("#winner")
        .attr("style", "color:blue");
      document.getElementById('loser').innerHTML = gop_pres + " and " + gop_vice;
      d3.select("#loser")
        .attr("style", "color:red");
      document.getElementById('loser2pre').innerHTML = "Second runners-up: ";
      document.getElementById('loser2').innerHTML = third_pres + " and " +third_vice;
      d3.select("#loser2")
        .attr("style", function(d) {
          if (third_name == "Democratic") {
            return "color:blue"
          } else if (third_name == "American Independent") {
            return "color:purple"
          } else if (third_name == "Progressive (1912)") {
            return "color:orange"
          } else if (third_name == "Progressive (1924)") {
            return "color:green"
          } else if (third_name == "States' Rights") {
            return "color:#663300"
          }
        });
    } 
  }
  
  // select pie paths
  var ev_path = pres_svg.selectAll(".outer")
      .data(pie([gop_ev, dem_ev, amer_ev, badDem_ev, prog_ev, progTwo_ev, SR_ev]));

  var vote_path = pres_svg.selectAll(".inner")
      .data(pie([gop_votes, dem_votes, amer_votes,
                 badDem_votes, prog_votes, progTwo_votes, SR_votes]));

    
  var ev_group = ev_path.enter().append("g");

  var vote_group = vote_path.enter().append("g");

  ev_slices = ev_group.append("path")
      .attr("class", "outer")
      .attr("fill", function(d, i) { 
        if(i == 0) {
          return "#ff8383";
        } else if (i == 1) {
          return "#75d1ff";
        } else if (i == 2) {
          return "#8533D6";
        } else if (i == 3) {
          return "blue";
        } else if (i == 4) {
          return "orange";
        } else if (i == 5) {
          return "green";
        } else if (i == 6) {
          return "#663300";
        }
      })
      .attr("d", function(d) {
        return arc(d);
      })
      .attr("transform", "translate(130, 120)")
      .each(function(d) { this._current = d; });

  ev_labels = ev_group.append("text")
    .attr("class", "textOuter")
    .attr("transform", function(d) {
      var x = arc.centroid(d)[0] + 130;
      var y = arc.centroid(d)[1] + 120;
      return "translate(" + x + ", " + y + ")";
    })
    .attr("text-anchor", "middle")
    .text(function(d) {
      // return total electoral votes
      if(d.value > 0) {
        return d.value;
      }
    });

  vote_slices = vote_group.append("path")
      .attr("class", "inner")
      .attr("fill", function(d, i) { 
        if(i == 0) {
          return "#ff8383";
        } else if (i == 1) {
          return "#75d1ff";
        } else if (i == 2) {
          return "#8533D6";
        } else if (i == 3) {
          return "blue";
        } else if (i == 4) {
          return "orange";
        } else if (i == 5) {
          return "green";
        } else if (i == 6) {
          return "#663300";
        }
      })
      .attr("d", function(d) {
        return arcInner(d);
      })
      .attr("transform", "translate(130, 120)")
      .each(function(d) { this._current = d; });


  vote_labels = vote_group.append("text")
    .attr("class", "textInner")
    .attr("transform", function(d) {
      var x = arcInner.centroid(d)[0] + 130;
      var y = arcInner.centroid(d)[1] + 120;
      return "translate(" + x + ", " + y + ")";
    })
    .attr("text-anchor", "middle")
    .text(function(d) {
      // return total electoral votes
      if(d.value > 0) {
        return d.value/1000000 + "M";
      }
    });


  // update if slices already exist
  ev_path = pres_svg.selectAll(".outer")
      .data(pie([gop_ev, dem_ev, amer_ev, badDem_ev, prog_ev, progTwo_ev, SR_ev]));

  ev_path
    .transition().duration(500).attrTween("d", arcTween);

  ev_text = pres_svg.selectAll(".textOuter")
      .data(pie([gop_ev, dem_ev, amer_ev, badDem_ev, prog_ev, progTwo_ev, SR_ev]));

  ev_text.transition().duration(500)
    .attr("transform", function(d) {
      var x = arc.centroid(d)[0] + 130;
      var y = arc.centroid(d)[1] + 120;
      return "translate(" + x + ", " + y + ")";
    })
    .text(function(d) {
      // return total electoral votes
      if(d.value > 0) {
        return d.value;
      }
    });;

  vote_path = pres_svg.selectAll(".inner")
      .data(pie([gop_votes, dem_votes, amer_votes,
                 badDem_votes, prog_votes, progTwo_votes, SR_votes]));

  vote_path
    .transition().duration(500).attrTween("d", arcTweenInner); 

  vote_text = pres_svg.selectAll(".textInner")
      .data(pie([gop_votes, dem_votes, amer_votes,
                 badDem_votes, prog_votes, progTwo_votes, SR_votes]));

  vote_text.transition().duration(500)
    .attr("transform", function(d) {
      var x = arcInner.centroid(d)[0] + 130;
      var y = arcInner.centroid(d)[1] + 120;
      return "translate(" + x + ", " + y + ")";
    })
    .text(function(d) {
      // return total electoral votes
      if(d.value > 0) {
        return (d.value/1000000).toFixed(1) + "M";
      }
    });; 

  
  //get state demographic data
  var st_white = 0;
  var st_black = 0;
  var st_native = 0;
  var st_asian = 0;
  var st_pacific = 0;
  var st_mult = 0;

  // updating values
  ELECGLOBAL.forEach(function(d) {
    // make sure all names line up between map json and data json
    if(d.year == CURRENT_YEAR && d.state == clickState) {
      st_white = d.white;
      st_black = d.black;
      st_native = d.native;
      st_asian = d.asian;
      st_pacific = d.pacific;
      st_mult = d.mult;
      st_name = d.state;
    }
  })

  // select pie paths
  var demo_path = st_demo_svg.selectAll("#demographic")
      .data(pie([st_white, st_black, st_native, st_asian, st_pacific, st_mult]));

  // add new slices for first time
  demo_path.enter().append("path")
      .attr("id", "demographic")
      .attr("fill", function(d, i) {
        return demo_scale(i);
      })
      .attr("d", function(d) {
        return arcDemo(d);
      })
      .attr("transform", "translate(130, 120)")
      .each(function(d) { this._current = d; });

  // prepare state-party line graph
  function isGood(obj) {
    return obj.state == clickState
  }

  function formatYear(year) {
    var year = year.toString();
    return year.charAt(2) + year.charAt(3)
  }

  var ELECFILTERED = ELECGLOBAL.filter(isGood);
  var ELEC_TOTALS = ELECGLOBAL.filter(function(obj) {return obj.state == "Totals"})


  var stPartyHeight = 300;
  var stPartyWidth = (getInnerWidth(d3.select("#stParty")) - 55);
  var x = d3.scale.linear().range([35, stPartyWidth]);
  var y = d3.scale.linear().range([stPartyHeight, 0]);

  var years = []

  ELECFILTERED.forEach(function(d, i) {
    years[i] = d.year;
  })

  years.reverse();

  var xAxis = d3.svg.axis().scale(x)
    .tickFormat(function(d) {return formatYear(d)})
    .tickValues(years)
    .orient("bottom").ticks(5);

  var yAxis = d3.svg.axis().scale(y)
    .orient("left").ticks(5);

  var yAxisDot = d3.svg.axis().scale(y)
    .orient("left").ticks(0);

  var valueline = d3.svg.line()
    .x(function(d) {  {return x(d.year)}} )
    .y(function(d) {  {return y(d.demPct)}});
    
  var valueline2 = d3.svg.line()  
    .x(function(d) { return x(d.year)})
    .y(function(d) {  {return y(d.gopPct)}}); 

  var valueline3 = d3.svg.line()
    .x(function(d) {  {return x(d.year)}} )
    .y(function(d) {  {return y(d.demPct)}});
    
  var valueline4 = d3.svg.line()  
    .x(function(d) { return x(d.year)})
    .y(function(d) {  {return y(d.gopPct)}}); 

  d3.selectAll(".pathLine")
    .remove();

  d3.selectAll(".axis")
    .remove();

  x.domain(d3.extent(ELECFILTERED, function(d) { return d.year }));
  // y.domain([0, d3.max(ELECFILTERED, function(d) {
  //    return Math.max(d.gopPct, d.demPct, d.thirdPct)})]);
  y.domain([0, 105]); 
  st_party_svg.append("path")
    .attr("class", "pathLine")
    .attr("d", valueline(ELECFILTERED));
    
  st_party_svg.append("path")
    .style("stroke", "red")
    .attr("class", "pathLine")
    .attr("d", valueline2(ELECFILTERED));

  st_party_svg.append("path")
    .style("stroke", "brown")
    .attr("class", "pathLine")
    .attr("d", valueline3(ELEC_TOTALS));

  st_party_svg.append("path")
    .style("stroke", "purple")
    .attr("class", "pathLine")
    .attr("d", valueline4(ELEC_TOTALS));

  // if (CURRENT_YEAR == 1968) {
  //   var valueline3 = d3.svg.line()  
  //     .x(function(d) { return x(d.year)})
  //     .y(function(d) {  {return y(d.thirdPct)} });

  //   st_party_svg.append("path")
  //     .style("stroke", "purple")
  //     .attr("class", "pathLine")
  //     .attr("d", valueline3(ELECFILTERED));
  // }

  st_party_svg.append("g")          
    .attr("class", "axis")
    .attr("transform", "translate(0," + stPartyHeight + ")")
    .call(xAxis)
    .selectAll("text")
    // .attr("x", -12)
    // this is bad because labels don't line up with ticks
    // .attr("transform", "rotate(-70)");

  st_party_svg.append("g")
    .attr("class", "axis")
    .attr("transform", "translate(35,0)")
    .call(yAxis); 

  // st_party_svg.append("g")
  //   .attr("class", "dotAxis")
  //   .attr("class", "axis")
  //   .attr("transform", "translate(" + (35 + 4.5 * (CURRENT_YEAR - 1912)) + ",0)")
  //   .style("stroke-dasharray", ("3, 3"))
  //   .call(yAxisDot); 

  // stTurnt
  // may actually be more useful to just have this shit on the same graph
  var stTurntHeight = 300;
  var stTurntWidth = (getInnerWidth(d3.select("#stTurnt")) - 55);

  function formatPct(pct) {
    pct *= 100;
    return pct;
  }

  var xTurnt = d3.scale.linear().range([35, stTurntWidth]);
  var yTurnt = d3.scale.linear().range([stTurntHeight, 0]);

  var yearsTurnt = []
  tickYear = 1980;
  while (tickYear <= 2012) {
    yearsTurnt.push(tickYear)
    tickYear += 4
  }

  var xAxisTurnt = d3.svg.axis().scale(xTurnt)
    .tickFormat(function(d) {return formatYear(d)})
    .tickValues(yearsTurnt)
    .orient("bottom").ticks(5);

  var yAxisTurnt = d3.svg.axis().scale(yTurnt)
    .tickFormat(function(d) {return formatPct(d)})
    .orient("left").ticks(5);

  var valuelineTurnt = d3.svg.line()
    .x(function(d, i) { if (d.year > 1979) { {return xTurnt(d.year)}}} )
    .y(function(d) {  {return yTurnt(d.turntA)}});
    
  var valuelineTurnt2 = d3.svg.line()  
    .x(function(d, i) {if (d.year > 1979) { return xTurnt(d.year)}})
    .y(function(d) {  {return yTurnt(d.turntE)}}); 

  var valuelineTurnt3 = d3.svg.line()  
    .x(function(d, i) {if (d.year > 1979) { return xTurnt(d.year)}})
    .y(function(d) {  {return yTurnt(d.turntE)}}); 

  var valuelineTurnt4 = d3.svg.line()  
    .x(function(d, i) {if (d.year > 1979) { return xTurnt(d.year)}})
    .y(function(d) {  {return yTurnt(d.turntA)}}); 

  xTurnt.domain([1980, 2012]);
  yTurnt.domain([0, 1])

  st_turnt_svg.append("path")
    .attr("class", "pathLine")
    .style("stroke", "orange")
    .attr("d", valuelineTurnt(ELECFILTERED));

  st_turnt_svg.append("path")
    .attr("class", "pathLine")
    .style("stroke", "green")
    .attr("d", valuelineTurnt2(ELECFILTERED));

  st_turnt_svg.append("path")
    .attr("class", "pathLine")
    .style("stroke", "yellow")
    .attr("d", valuelineTurnt3(ELEC_TOTALS));

  st_turnt_svg.append("path")
    .attr("class", "pathLine")
    .style("stroke", "purple")
    .attr("d", valuelineTurnt4(ELEC_TOTALS));

  st_turnt_svg.append("g")          
    .attr("class", "axis")
    .attr("transform", "translate(0," + (stTurntHeight+10) + ")")
    .call(xAxisTurnt)
    .selectAll("text")
    // .attr("x", -12)
    // .attr("transform", "rotate(-70)");

  st_turnt_svg.append("g")
    .attr("class", "axis")
    .attr("transform", "translate(35,10)")
    .call(yAxisTurnt); 

  // update choropleth
  var state_paths = states.selectAll("path");
  var state_pattern_path = state_pattern.selectAll("path");

  var state_text = states.selectAll("text");
  
  state_paths
    .on("click", function() {
      clickState = this.id;
      document.getElementById("clickState").innerHTML = clickState;
      updateVis();
    })
    // http://chimera.labs.oreilly.com/books/1230000000345/ch10.html#_html_div_tooltips
    // https://github.com/mbostock/d3/wiki/Selections
    // .on("mouseover", function() {
    //   console.log(this);})
    // .on("mouseout", function() {
    //   d3.select(this)
    //     .attr("fill", "blue");
    // })
    .style('cursor', 'pointer');
//     .on("mouseover", function(d) {console.log('mouseover!');
// console.log(this);
// //Get this bar's x/y values, then augment for the tooltip
// var xPosition = d3.event.pageX;//parseFloat(d3.select(this).attr("x"));// + xScale.rangeBand() / 2;
// var yPosition = d3.event.pageY;//parseFloat(d3.select(this).attr("y")) / 2 ;//+ h / 2;

// //Update the tooltip position and value
// d3.select("#tooltip")
//   .style("left", xPosition + "px")
//   .style("top", yPosition + "px")
  

// //Show the tooltip
// d3.select("#tooltip").classed("hidden", false);

// })
//     .on("mouseout", function() {console.log('mouseout!');

// //Hide the tooltip
// d3.select("#tooltip").classed("hidden", true);

// })

  // var div = state_paths.append('div');
  // div
  //   .attr('class', 'hidden')
  //   .attr('id', 'tooltip')
  //   .html("hello world");

  state_pattern_path.transition().duration(500)
    // .attr("fill", "url(#vertical-stripe-1)");
    // .attr("fill-opacity", .5)
    .attr("fill", function() {
      if (this.id == dem_home && this.id == gop_home) {
        return "url(#ladder-stripe-1)"
      } else if (this.id == gop_home) {
        return "url(#horizontal-stripe-1)"
      } else if (this.id == dem_home) {
        return "url(#vertical-stripe-1)"
      } else if (this.id == third_home) {
        return "url(#diagonal-stripe-1)"
      } else {
        return "white"
      }
    })
    .attr("fill-opacity", function() {
      if (this.id != dem_home && this.id != gop_home && this.id != third_home) {
        return 0
      } else {
        return 1
      }
    });
    

  state_paths.append("title")
    .text(function(d) {return d.properties.NAME});

  state_paths.transition().duration(500)
    .attr("fill", function() { 
    var that = this;
    var noodle = "cat";
    var current_states_obj = ELECGLOBAL.filter(function(obj) {
      return obj.year == CURRENT_YEAR
    })
    var current_states_str = []
    current_states_obj.forEach(function(d) {
      current_states_str.push(d.name)
    })
    if (!(this.id in current_states_str)) {
      noodle = "gray"
    }
    ELECGLOBAL.forEach(function(d) {
      if(d.year == CURRENT_YEAR && d.state == that.id) {
        // if there is a third party 
        if (d.thirdPct !== null) {
          // if the third party loses the state
          if (d.thirdPct < d.demPct || d.thirdPct < d.gopPct) {
            noodle = quantize(Math.max(d.thirdPct,d.demPct) - Math.max(d.thirdPct, d.gopPct));
          // if the third party wins the state
          } else {
            // what if third party is just always purple?
            if (third_name == "Democratic") {
              // blue, but with distinction from main blue
              var quantizeThird = d3.scale.quantize()
                .domain([0, 20])
                .range(["#335CAD","#1947A3","#003399","#002E8A"]);
            } else if (third_name == "American Independent") {
              // purple
              var quantizeThird = d3.scale.quantize()
                .domain([0, 20])
                .range(["#D1B2F0","#C299EB","#B280E6","#A366E0"]);
            } else if (third_name == "Progressive (1912)") {
              // orange
              var quantizeThird = d3.scale.quantize()
                .domain([0, 20])
                .range(["#FFB84D","#FFAD33","#FFA319","#FF9900"]);
            } else if (third_name == "Progressive (1924)") {
              // green
              var quantizeThird = d3.scale.quantize()
                .domain([0, 20])
                .range(["#4DDB4D","#33D633","#19D119","#00CC00"]);
            } else if (third_name == "States' Rights") {
              // brown
              var quantizeThird = d3.scale.quantize()
                .domain([0, 20])
                .range(["#94704D","#855C33","#754719","#663300"]);
            }
            noodle = quantizeThird(d.thirdPct - Math.max(d.demPct, d.gopPct));
          }
        // if there is no third party
        } else {
          noodle = quantize(d.demPct - d.gopPct);
        }
      } 
    })
    return noodle;
     
    })
    .attr("fill-opacity", .5)
    // .attr("class", "circles-1");
    // .attr("fill-opacity", .5)
    // .attr("fill", "url(#verticall-stripe-1) blue")
    // .attr("fill", "blue");
    
    // state_paths.transition(5000)
    //   .attr("fill", "url(#vertical-stripe-1) blue");

  state_text.transition().duration(500)
    .text(function() {
      var that = this;
      var noodle = "";
      ELECGLOBAL.forEach(function(d) {
        if(d.year == CURRENT_YEAR && d.state.concat("txt") == that.id) {
          var total_ev = d.demEV + d.gopEV + d.thirdEV;
          // console.log(total_ev.toString());
          noodle = total_ev.toString();
        }
      })
      return noodle;
    })
    .attr("fill", "black");
};



// initializes the visualization
var initVis = function (error, stateJson, elecData) {
  // assign election data global
  ELECGLOBAL = elecData
  
  // draw states


  state_pattern.selectAll("path")
    .data(stateJson.features)
    .enter().append("path")
    .attr("id", function(d) { return d.properties.NAME; })
    .attr("d", path)
    .attr("fill", "white")

  states.selectAll("path")
    .data(stateJson.features)
    .enter().append("path")
    .attr("id", function(d) { return d.properties.NAME; })
    .attr("d", path)
    .attr("fill", function(d) { if(d.properties.CENSUSAREA > 113590) {
        return "#AAAAAA"; 
      } else {
        return "#AAAAAA";
      }
      })
    .attr("fill-opacity", .5)
    .attr("stroke", "#555555")
    .attr("stroke-width", 1.5)

  states.selectAll("text")
    .data(stateJson.features)
    .enter().append("svg:text")
    .text(function(d) { return ""; })
    .attr("x", function(d) { return path.centroid(d)[0]; })
    .attr("y", function(d) { return path.centroid(d)[1]; })
    .attr("text-anchor", "middle")
    .attr("id", function(d) { return d.properties.NAME.concat("txt"); });
  
  // create donuts for first time
  // var ev_group = pres_svg.selectAll("path, .outer")
  //     .data(pie([1, 1, 1, 1, 1, 1, 1]))
  //   .enter()
  //     .append("g")

  // var ev_path = ev_group.append("path")
  //     .attr("class", "outer")
  //     .attr("fill", function(d, i) { 
  //       if(i == 0) {
  //         return "#ff8383";
  //       } else if (i == 1) {
  //         return "#75d1ff";
  //       } else if (i == 2) {
  //         return "#8533D6";
  //       } else if (i == 3) {
  //         return "blue";
  //       } else if (i == 4) {
  //         return "orange";
  //       } else if (i == 5) {
  //         return "green";
  //       } else if (i == 6) {
  //         return "#663300";
  //       }
  //     })
  //     .attr("d", function(d) {
  //       return arc(d);
  //     })
  //     .attr("transform", "translate(130, 120)")
  //     .each(function(d) { this._current = d; });


  // load in our central election data file
  updateVis()
};

// loads data and then calls visualization-drawing function
var startHere = function () {
  queue()
    .defer(d3.json, "data/us_states_small.json")
    .defer(d3.json, "data/jsonMain.json")
    .await(initVis);
};

startHere()

</script>
</body>
</html>