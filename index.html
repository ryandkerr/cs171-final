<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>Electoral Map - Final Project</title>

  <!-- ADD Libraries-->
  <script src="libs/d3/d3.min.js" charset="utf-8"></script>
  <script src="libs/jquery/jquery-2.1.1.min.js" charset="utf-8"></script>
  <script src="libs/bootstrap/js/bootstrap.min.js" charset="utf-8"></script>
  <script src="http://d3js.org/queue.v1.min.js"></script>

  <!--Stylesheets-->
  <link rel="stylesheet" type="text/css" href="libs/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="content/style-index.css">
  <link rel="shortcut icon" href="content/favicon.ico">
  <style>
  .pathLine { 
    stroke: steelblue;
    stroke-width: 2;
    fill: none;
  }



/*#tooltip {
        position: absolute;
        width: 200px;
        height: auto;
        padding: 10px;
        background-color: white;
        -webkit-border-radius: 10px;
        -moz-border-radius: 10px;
        border-radius: 10px;
        -webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
        -moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
        box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
        pointer-events: none;
}

#tooltip.hidden {
        display: none;
}

#tooltip p {
        margin: 0;
        font-family: sans-serif;
        font-size: 16px;
        line-height: 20px;
}*/

  .axis pathLine,
  .axis line {
    fill: none;
    stroke: grey;
    stroke-width: 0;
    shape-rendering: crispEdges;
  }
  .dotAxis {

  }
  </style>

  <!--Patterns-->
  <!--actually width 4-->
  <svg height="10" width="10" xmlns="http://www.w3.org/2000/svg" version="1.1"> <defs> <pattern id="vertical-stripe-1" patternUnits="userSpaceOnUse" width="10" height="10"> <image xlink:href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPScxMCcgaGVpZ2h0PScxMCc+CiAgPHJlY3Qgd2lkdGg9JzEwJyBoZWlnaHQ9JzEwJyBmaWxsPSd3aGl0ZScgLz4KICA8cmVjdCB4PScwJyB5PScwJyB3aWR0aD0nNCcgaGVpZ2h0PScxMCcgZmlsbD0nYmxhY2snIC8+Cjwvc3ZnPg==" x="0" y="0" width="10" height="10"> </image> </pattern> </defs> </svg>

  <svg height="10" width="10" xmlns="http://www.w3.org/2000/svg" version="1.1"> <defs> <pattern id="horizontal-stripe-1" patternUnits="userSpaceOnUse" width="10" height="10"> <image xlink:href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPScxMCcgaGVpZ2h0PScxMCc+CiAgPHJlY3Qgd2lkdGg9JzEwJyBoZWlnaHQ9JzEwJyBmaWxsPSd3aGl0ZScgLz4KICA8cmVjdCB4PScwJyB5PScwJyB3aWR0aD0nMTAnIGhlaWdodD0nNCcgZmlsbD0nYmxhY2snIC8+Cjwvc3ZnPg==" x="0" y="0" width="10" height="10"> </image> </pattern> </defs> </svg>

  <svg height="10" width="10" xmlns="http://www.w3.org/2000/svg" version="1.1"> <defs> <pattern id="ladder-stripe-1" patternUnits="userSpaceOnUse" width="10" height="10"> <image xlink:href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPScxMCcgaGVpZ2h0PScxMCc+ICA8cmVjdCB3aWR0aD0nMTAnIGhlaWdodD0nMTAnIGZpbGw9J3doaXRlJyAvPiAgPHJlY3QgeD0nMCcgeT0nMCcgd2lkdGg9JzQnIGhlaWdodD0nMTAnIGZpbGw9J2JsYWNrJyAvPiAgPHJlY3QgeD0nMCcgeT0nMCcgd2lkdGg9JzEwJyBoZWlnaHQ9JzQnIGZpbGw9J2JsYWNrJyAvPjwvc3ZnPg==" x="0" y="0" width="10" height="10"> </image> </pattern> </defs> </svg>

  <svg height="10" width="10" xmlns="http://www.w3.org/2000/svg" version="1.1"> <defs> <pattern id="diagonal-stripe-1" patternUnits="userSpaceOnUse" width="10" height="10"> <image xlink:href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPScxMCcgaGVpZ2h0PScxMCc+CiAgPHJlY3Qgd2lkdGg9JzEwJyBoZWlnaHQ9JzEwJyBmaWxsPSdibGFjaycvPgogIDxwYXRoIGQ9J00tMSwxIGwyLC0yCiAgICAgICAgICAgTTAsMTAgbDEwLC0xMAogICAgICAgICAgIE05LDExIGwyLC0yJyBzdHJva2U9J3doaXRlJyBzdHJva2Utd2lkdGg9JzMnLz4KPC9zdmc+" x="0" y="0" width="10" height="10"> </image> </pattern> </defs> </svg>
</head>

<body>
  <!-- <div class="container-fluid"> -->
  <div class="container-fluid">
    <div class="row" id="title"> 
      <div class="col-md-11">
        <h1>American Electoral Politics: The Past 100 Years</h1>
        
      </div>
      <div class="col-md-1">
        <span class="header-right-clickable">
            <a href="about/about.html">about</a>
        </span>
      </div>
    </div>

    <div class="row">
      <div class="col-md-3">
      </div>
      <div class="col-md-6">
      <p class="exploreData">Click a state or drag the slider to explore the data!</p>
      </div>

    </div>
    
    <div class="row"> 
      <!-- <div class="col-md-3" id="presVis" style="background-color: #FFD8D8"> -->
      <div class="col-md-3" id="presVis" style="text-align:center">
        <h2 class="centered"><span class="cur">2012</span> Election</h2>
        <h4 class="centered">Winners: <span id="winner"></span></h4>
        <h4 class="centered">Runners-up: <span id="loser"></span></h4>
        <h4 class="centered"> <span id="loser2pre"></span><span id="loser2"></span></h4>
      </div>

      <!-- <br> -->
      <!-- <div class="col-md-9" id="col1" style="background-color: #CCF2FF"> -->
      <div class="col-md-7" id="col1">
        
        <div id="choroVis">
          <!-- Main Cloropleth goes here -->
        </div>

        <div class="row" id="slider">
          <!-- Slider here -->
          <form>
            <div>
              <label>Year:</label>
              <label>1912</label>
              <label><input type="range" name="points" min='1912' max='2012' step="4" value="2012" id="year_slider" oninput="changeYear(this.value);" style="width: 300px"></label><label>2012 (Currently showing <span class="cur">2012</span>)</label>
            </div>
          </form>
        </div>
        <br>
      </div>

      <div class="col-md-2" id="storyCol">
<!--       code taken from https://github.com/jbencook/cs171-ag-viz/blob/master/src/CountyData.html
 -->
        <div id="storyControls" style="position:absolute; top:20px; left:25px; z-index: 999;">
          <div id="storyPages" class="btn-group btn-group-sm">
              <button type="button" class="btn btn-default" value=1>1</button>
              <button type="button" class="btn btn-default" value=2>2</button>
              <button type="button" class="btn btn-default" value=3>3</button>
              <button type="button" class="btn btn-default" value=4>4</button>
              <button type="button" class="btn btn-default" value=5>5</button>
              <button type="button" class="btn btn-default" value=6>6</button>
          </div>
          <br><br>
          <div>
          <p class="storyP">Click the buttons above to see the story of American Electoral Politics</p>
          </div>
        </div>
      </div>
    </div>

    <div class="row" id="state-div">

      <h2>State Views: <span class="clickState">Alabama</span>, <span class="cur">2012</span></h2>
      Select state: <select id="dropState"></select>
      
      <p></p>
    </div>
    
    <div class="row" id="row2">
      <div class="col-md-4" id="stCompare">
        <p></p>
        <div id="state-title"><span class="clickState">Alabama</span> to All States comparison</div> <br>
      </div>
      <div class="col-md-8" id="stDemographic0">
        <div class="row">
          <div class="col-md-2">          </div>
          <div class="col-md-4" id="stDemographic">
            <p></p>
            <div id="state-title"><span class="clickState">Alabama</span> Voter Eligibility (1980+)</div> 
            <br>
            <span id="noFelon"></span>
          </div>
          <div class="col-md-4" id="stDemographic2">
            <p></p>
            <div id="state-title2">USA Voter Eligibility</div> 
            <br>
            <span id="noFelon2"></span>
          </div>
          <div class="col-md-2">          </div> 
        </div>
      </div>
    </div>


    <div class="row" id="state-div-size">      
      <div class="col-md-4" id="stParty">
        <p></p>
        <div id="state-title">Political Party Trends: <span class="clickState">Alabama</span></div> <br>
      </div>
      <div class="col-md-3" id="stTurnt">
        <p></p>
            <div id="state-title">Voter Turnout: <span class="clickState">Alabama</span></div> <br>
      </div>
      <!--replicate stParty for national EV and national pct-->
      <div class="col-md-5" id="stInc">
        <p></p>
        <div id="state-title">Median Household Income: <span class="clickState">Alabama</span></div> <br>
      </div>
    </div>
  </div>

<!-- <script src="data/medInc.js"></script> -->
<script>

// some of this code is taken from these sources:
// http://bl.ocks.org/stevenae/8362841
// http://synthesis.sbecker.net/articles/2012/07/18/learning-d3-part-7-choropleth-maps
// http://bl.ocks.org/mbostock/4060606
// http://bl.ocks.org/mbostock/3887235
// http://bl.ocks.org/mbostock/1346410
// http://bl.ocks.org/mbostock/3151228
// http://bl.ocks.org/d3noob/e34791a32a54e015f57d
// http://bl.ocks.org/mbostock/4403522
// http://bl.ocks.org/d3noob/e1aa61856118edfa624d
// http://bocoup.com/weblog/using-svg-patterns-as-fills/
// http://chimera.labs.oreilly.com/books/1230000000345/ch10.html#_html_div_tooltips
// http://www.d3noob.org/2012/12/adding-axis-labels-to-d3js-graph.html
// http://jsfiddle.net/nExgJ/


// helper to find width of element
var getInnerWidth = function(element) {
    var style = window.getComputedStyle(element.node(), null);
    return parseInt(style.getPropertyValue('width'));
};

// global variables
var WIDTH = getInnerWidth(d3.select("#col1")) - 15;
var HEIGHT = 600;
var ELECGLOBAL;
var INCGLOBAL;
var CURRENT_YEAR = 2012;


// function to change the year and update vis, yext, and slider
var changeYear = function(year) {
  CURRENT_YEAR = year;
  document.getElementsByClassName('cur')[0].innerHTML = CURRENT_YEAR;
  document.getElementsByClassName('cur')[1].innerHTML = CURRENT_YEAR;
  document.getElementsByClassName('cur')[2].innerHTML = CURRENT_YEAR;
  d3.select("#year_slider")[0][0].value = year;
  updateVis();
}

var story0 = document.getElementsByClassName("storyP")[0];

// story mode button listeners
d3.selectAll(".btn")
  .on("click", function() {
    if(this.value == 1) {
      changeYear(1912);
      story0.innerHTML = "<p>In 1912, when former President Theodore Roosevelt failed to receive the Republican nomination, he called his own convention and created the Progressive Party (nicknamed the \"Bull Moose Party\").<br><br>This was the last election in which a candidate who was not a Republican or Democrat came second in either the popular vote or the Electoral College, and the first election in which all 48 states of the contiguous United States participated. <br><br> <a title=\"By Harris & Ewing [Public domain], via Wikimedia Commons\" href=\"http://commons.wikimedia.org/wiki/File%3AWoodrow_Wilson-H%26E.jpg\"><img width=\"200\" alt=\"Woodrow Wilson-H&E\" src=\"//upload.wikimedia.org/wikipedia/commons/thumb/4/4d/Woodrow_Wilson-H%26E.jpg/256px-Woodrow_Wilson-H%26E.jpg\"/></a> <br><br> Winner: Woodrow Wilson!";
      setTimeout(function() { changeYear(1936) }, 5000);
    } else if(this.value == 2) {
      changeYear(1924);
      story0.innerHTML = "This is a shitty story about the election.";
    } else if(this.value == 3) {
      changeYear(1964)
      story0.innerHTML = "This is a noob story about the election.";
    } else if(this.value == 4) {
      changeYear(1980)
      story0.innerHTML = "This is a red story about the election.";
    } else if(this.value == 5) {
      changeYear(2000)
      story0.innerHTML = "This is a blue story about the election.";
    } else if(this.value == 6) {
      changeYear(2012)
      story0.innerHTML = "This is a fish story about the election.";
    }
  })



// scale to assign margin of victory to bins, which end up as colors
var quantize = d3.scale.quantize()
  .domain([-20, 20])
  .range(["#ff8383", "#ff9e9e", "#ffbaba", "#ffd6d6", "#c2eaff", "#aae2ff", "#91daff", "#75d1ff"]);

var demo_scale = d3.scale.ordinal()
  .domain([0, 1, 2]) 
  .range(["#5C3D00", "#7A5200", "#A37519"]);

// create svg canvas in chorovis div
var choro_svg = d3.select("#choroVis")
  .append("svg")
  .attr("width", WIDTH)
  .attr("height", HEIGHT);

// create svg canvas for president vis
var pres_svg = d3.select("#presVis")
  .append("svg")
  // .attr("width", getInnerWidth(d3.select("#presVis")))
  .attr("width", 280)
  .attr("height", 600);
  // .attr("class", "centered");

// create svg canvas for president vis
var st_demo_svg = d3.select("#stDemographic")
  .append("svg")
  .attr("width", getInnerWidth(d3.select("#stDemographic")))
  .attr("height", 300);

var elig_svg = d3.select("#stDemographic")
  .append("svg")
  .attr("width", getInnerWidth(d3.select("#stDemographic")))
  .attr("height", 300);

var st_demo2_svg = d3.select("#stDemographic2")
  .append("svg")
  .attr("width", getInnerWidth(d3.select("#stDemographic2")))
  .attr("height", 300);

var elig2_svg = d3.select("#stDemographic2")
  .append("svg")
  .attr("width", getInnerWidth(d3.select("#stDemographic2")))
  .attr("height", 300);

// create svg canvas for stParty vis
var st_party_svg = d3.select("#stParty")
  .append("svg")
  .attr("width", getInnerWidth(d3.select("#stParty")))
  .attr("height", 450);

// create svg canvas for stTurnt vis
var st_turnt_svg = d3.select("#stTurnt")
  .append("svg")
  .attr("width", getInnerWidth(d3.select("#stTurnt")))
  .attr("height", 450);

var st_inc_svg = d3.select("#stInc")
  .append("svg")
  .attr("width", getInnerWidth(d3.select("#stInc")))
  .attr("height", 450);

var st_comp_svg = d3.select("#stCompare")
  .append("svg")
  .attr("width", getInnerWidth(d3.select("#stCompare")))
  .attr("height", 450);

// create usa projection
var projection = d3.geo.albersUsa()
  .scale(1050);

var path = d3.geo.path()
  .projection(projection);


var state_pattern = choro_svg.append("g")
  .attr("class", "state_pattern")
  .attr("transform", "translate(-40, 30)");

var states = choro_svg.append("g")
  .attr("class", "states")
  .attr("transform", "translate(-40, 30)");



// pie chart functions
var arc = d3.svg.arc()
  .outerRadius(100)
  .innerRadius(70);

var arcInner = d3.svg.arc()
  .outerRadius(53)
  .innerRadius(23);

var arcDemo = d3.svg.arc()
  .outerRadius(100)
  .innerRadius(0);

var pie = d3.layout.pie()
  .sort(null)
  .value(function(d) { return d; }); 

var arcTween = function (a) {
  var i = d3.interpolate(this._current, a);
  this._current = i(0);
  return function(t) {
    return arc(i(t));
  };
}

var arcTweenInner = function (a) {
  var i = d3.interpolate(this._current, a);
  this._current = i(0);
  return function(t) {
    return arcInner(i(t));
  };
}

// make arc for text
var ev_arc = d3.svg.arc()
  .innerRadius(135)
  .outerRadius(135)
  .startAngle(- Math.PI / 7.3)
  .endAngle(Math.PI / 7.3)

var vote_arc = d3.svg.arc()
  .innerRadius(85)
  .outerRadius(85)
  .startAngle(- Math.PI / 6)
  .endAngle(Math.PI / 6);

// add curved text
pres_svg.append("path")
  .attr("id", "ev_words")
  .attr("d", ev_arc())
  .attr("transform", "translate(130, 120)");

pres_svg.append("path")
  .attr("id", "vote_path")
  .attr("d", vote_arc())
  .attr("transform", "translate(130, 120)");

pres_svg.append("text")
  .attr("x", 8)
  .attr("dy", 28)
  .append("textPath")
  .attr("class", "textpath")
  .attr("xlink:href", "#ev_words")
  .text("Electoral Votes");

pres_svg.append("text")
  .attr("x", 8)
  .attr("dy", 28)
  .append("textPath")
  .attr("class", "textpath")
  .attr("xlink:href", "#vote_path")
  .text("Popular Vote");

// add legend/key for colors
var legend = pres_svg.append("g")
  .attr("transform", "translate(0, 255)");

// "Legend"
legend.append("text")
  .text("Legend")
  .attr("font-size", "28px")
  .attr("text-decoration", "underline")
  .attr("transform", "translate(85, 0)");

// "Margin of Victory - Popular Vote
legend.append("text")
  .text("Margin of Victory - Popular Vote")
  .attr("font-size", "16px")
  .attr("font-weight", "bold")
  .attr("transform", "translate(20, 25)");

// "Party"
legend.append("text")
  .text("Party")
  .attr("text-decoration", "underline")
  .attr("font-size", "14px")
  .attr("transform", "translate(20, 40)");

// Percentages
legend.append("text")
  .text("0%__5%__10%__15%")
  .attr("text-decoration", "underline")
  .attr("font-size", "14px")
  .attr("transform", "translate(125, 40)");

// Parties
legend.append("text")
  // .text("Democratic\nRepublican\nAmerican Independent\nState's Rights\nProgressive (1924)\nProgressive (1912)")
  .text("Democratic")
  .attr("font-size", "14px")
  .attr("transform", "translate(20, 60)")

legend.append("text")
  .text("Republican")
  .attr("font-size", "14px")
  .attr("transform", "translate(20, 75)");

legend.append("text")
  .text("American")
  .attr("font-size", "14px")
  .attr("transform", "translate(20, 90)");

legend.append("text")
  .text("Independent")
  .attr("font-size", "14px")
  .attr("transform", "translate(30, 105)");


legend.append("text")
  .text("State's Rights")
  .attr("font-size", "14px")
  .attr("transform", "translate(20, 120)");

legend.append("text")
  .text("Progressive (1924)")
  .attr("font-size", "14px")
  .attr("transform", "translate(20, 135)")

legend.append("text")
  .text("Progressive (1912)")
  .attr("font-size", "14px")
  .attr("transform", "translate(20, 150)")

legend.append("text")
  .text("Presidential Birth States")
  .attr("font-size", "16px")
  .attr("font-weight", "bold")
  .attr("transform", "translate(20, 175)")

legend.append("text")
  .text("Democratic")
  .attr("font-size", "14px")
  .attr("transform", "translate(20, 190)")

legend.append("text")
  .text("Republican")
  .attr("font-size", "14px")
  .attr("transform", "translate(110, 190)")

legend.append("text")
  .text("3rd Party")
  .attr("font-size", "14px")
  .attr("transform", "translate(200, 190)")

legend.append("rect")
  .attr("x", 20)
  .attr("y", 195)
  .attr("width", 80)
  .attr("height", 40)
  .attr("stroke", "black")
  .attr("fill", "url(#vertical-stripe-1)")
  .attr("fill-opacity", .3);


legend.append("rect")
  .attr("x", 110)
  .attr("y", 195)
  .attr("width", 80)
  .attr("height", 40)
  .attr("stroke", "black")
  .attr("fill", "url(#horizontal-stripe-1)")
  .attr("fill-opacity", .3);



legend.append("rect")
  .attr("x", 200)
  .attr("y", 195)
  .attr("width", 80)
  .attr("height", 40)
  .attr("stroke", "black")
  .attr("fill", "url(#diagonal-stripe-1)")
  .attr("fill-opacity", .3);



var addColors = function(y_coord, colors) {
  legend.append("rect")
    .attr("x", 130)
    .attr("y", y_coord - 10)
    .attr("width", 28)
    .attr("height", 10)
    // .attr("stroke", "black")
    // .attr("stroke-width", "1px")
    .attr("fill", colors[0]);
  
  legend.append("rect")
    .attr("x", 165)
    .attr("y", y_coord - 10)
    .attr("width", 28)
    .attr("height", 10)
    .attr("fill", colors[1]);
  
  legend.append("rect")
    .attr("x", 200)
    .attr("y", y_coord - 10)
    .attr("width", 28)
    .attr("height", 10)
    .attr("fill", colors[2]);
  
  legend.append("rect")
    .attr("x", 235)
    .attr("y", y_coord - 10)
    .attr("width", 28)
    .attr("height", 10)
    .attr("fill", colors[3]);
}

// arrays with state colors
var dem_colors = ["#c2eaff", "#aae2ff", "#91daff", "#75d1ff"];
var gop_colors = ["#ffd6d6", "#ffbaba", "#ff9e9e", "#ff8383"];
// var amer_colors = ["#D1B2F0", "#C299EB", "#B280E6", "#A366E0"];
var amer_colors = ["#C8A5F9","#BC98E7","#B08CD4","#A37FC2"];
var sr_colors = ["#FEAD4A","#F2A346","#E69943","#DA8F3F"];
var prog24_colors = ["#57F1A4","#4BDC98","#40C88C","#36B480"];
var prog12_colors = ["#F8E48D","#E7D281","#D6C176","#C6B06C"];

addColors(60, dem_colors);
addColors(75, gop_colors);
addColors(90, amer_colors);
addColors(120, sr_colors);
addColors(135, prog24_colors);
addColors(150, prog12_colors);

// initialize state views for Alabama before user clicks anything
var clickState = "Alabama";

// updates choropleth with election data
var updateVis = function () {

  // figure out winner for that year
  var gop_ev = 0;
  var dem_ev = 0;
  var amer_ev = 0;
  var badDem_ev = 0;
  var SR_ev = 0;
  var prog_ev = 0;
  var progTwo_ev = 0;
  var gop_votes = 0;
  var dem_votes = 0;
  var badDem_votes = 0;
  var amer_votes = 0;
  var SR_votes = 0;
  var prog_votes = 0;
  var progTwo_votes = 0;
  var gop_pres;
  var dem_pres;
  var third_pres;
  var gop_vice;
  var dem_vice;
  var third_vice;
  var third_name;
  var gop_home;
  var dem_home;
  var third_home;

  ELECGLOBAL.forEach(function(d) {
    if(d.year == CURRENT_YEAR && d.state == "Totals") {
      gop_ev = d.gopEV;
      dem_ev = d.demEV;
      if (d.thirdName == "American Independent") {
        amer_ev = d.thirdEV;
        amer_votes = d.thirdVotes;
      } else if (d.thirdName == "Democratic") {
        badDem_ev = d.thirdEV;
        badDem_votes = d.thirdVotes;
      } else if (d.thirdName == "States' Rights") {
        SR_ev = d.thirdEV;
        SR_votes = d.thirdVotes;
      } else if (d.thirdName == "Progressive (1912)") {
        prog_ev = d.thirdEV;
        prog_votes = d.thirdVotes;
      } else if (d.thirdName == "Progressive (1924)") {
        progTwo_ev = d.thirdEV;
        progTwo_votes = d.thirdVotes;
      }

      gop_votes = d.gopVotes;
      dem_votes = d.demVotes;

      gop_home = d.gopPresBorn;
      dem_home = d.demPresBorn;
      third_home = d.thirdPresBorn;

      gop_pres = d.gopPres;
      dem_pres = d.demPres;
      third_pres = d.thirdPres;
      gop_vice = d.gopVice;
      dem_vice = d.demVice;
      third_vice = d.thirdVice;

      third_name = d.thirdName;
    }
  })
  
  // change names in html
  // if there is no third party
  if (third_pres == "") {
    if(gop_ev > dem_ev) {
      document.getElementById('winner').innerHTML = gop_pres + " and " + gop_vice;
      d3.select("#winner")
        .attr("style", "color:red");
      document.getElementById('loser').innerHTML = dem_pres + " and " + dem_vice;
      d3.select("#loser")
        .attr("style", "color:blue");
      document.getElementById('loser2pre').innerHTML = "";
      document.getElementById('loser2').innerHTML = "";
    } else {
      document.getElementById('winner').innerHTML = dem_pres + " and " + dem_vice;
      d3.select("#winner")
        .attr("style", "color:blue");

      document.getElementById('loser').innerHTML = gop_pres + " and " + gop_vice;
      d3.select("#loser")
        .attr("style", "color:red");
      document.getElementById('loser2pre').innerHTML = "";
      document.getElementById('loser2').innerHTML = "";
    } 
  // if there is a third party
  } else {
    if(gop_ev > dem_ev) {
      document.getElementById('winner').innerHTML = gop_pres + " and " + gop_vice;
      d3.select("#winner")
        .attr("style", "color:red");
      document.getElementById('loser').innerHTML = dem_pres + " and " + dem_vice;
      d3.select("#loser")
        .attr("style", "color:blue");
      document.getElementById('loser2pre').innerHTML = "Second runners-up: ";
      document.getElementById('loser2').innerHTML = third_pres + " and " + third_vice;
      d3.select("#loser2")
        .attr("style", function(d) {
          if (third_name == "Democratic") {
            return "color:blue"
          } else if (third_name == "American Independent") {
            return "color:purple"
          } else if (third_name == "Progressive (1912)") {
            return "color:orange"
          } else if (third_name == "Progressive (1924)") {
            return "color:green"
          } else if (third_name == "States' Rights") {
            return "color:#663300"
          }
        });
    } else {
      document.getElementById('winner').innerHTML = dem_pres + " and " + dem_vice;
      d3.select("#winner")
        .attr("style", "color:blue");
      document.getElementById('loser').innerHTML = gop_pres + " and " + gop_vice;
      d3.select("#loser")
        .attr("style", "color:red");
      document.getElementById('loser2pre').innerHTML = "Second runners-up: ";
      document.getElementById('loser2').innerHTML = third_pres + " and " +third_vice;
      d3.select("#loser2")
        .attr("style", function(d) {
          if (third_name == "Democratic") {
            return "color:blue"
          } else if (third_name == "American Independent") {
            return "color:purple"
          } else if (third_name == "Progressive (1912)") {
            return "color:orange"
          } else if (third_name == "Progressive (1924)") {
            return "color:green"
          } else if (third_name == "States' Rights") {
            return "color:#663300"
          }
        });
    } 
  }
  
  // select pie paths
  var ev_path = pres_svg.selectAll(".outer")
      .data(pie([gop_ev, dem_ev, amer_ev, badDem_ev, prog_ev, progTwo_ev, SR_ev]));

  var vote_path = pres_svg.selectAll(".inner")
      .data(pie([gop_votes, dem_votes, amer_votes,
                 badDem_votes, prog_votes, progTwo_votes, SR_votes]));

    
  var ev_group = ev_path.enter().append("g");

  var vote_group = vote_path.enter().append("g");

  ev_slices = ev_group.append("path")
      .attr("class", "outer")
      .attr("fill", function(d, i) { 
        if(i == 0) {
          return "#ff8383";
        } else if (i == 1) {
          return "#75d1ff";
        } else if (i == 2) {
          return amer_colors[3];
        } else if (i == 3) {
          return dem_colors[1];
        } else if (i == 4) {
          return prog12_colors[3];
        } else if (i == 5) {
          return prog24_colors[3];
        } else if (i == 6) {
          return sr_colors[3];
        }
      })
      .attr("d", function(d) {
        return arc(d);
      })
      .attr("transform", "translate(130, 120)")
      .each(function(d) { this._current = d; });

  ev_labels = ev_group.append("text")
    .attr("class", "textOuter")
    .attr("transform", function(d) {
      var x = arc.centroid(d)[0] + 130;
      var y = arc.centroid(d)[1] + 120;
      return "translate(" + x + ", " + y + ")";
    })
    .attr("text-anchor", "middle")
    .text(function(d) {
      // return total electoral votes
      if(d.value > 0) {
        return d.value;
      }
    });

  vote_slices = vote_group.append("path")
      .attr("class", "inner")
      .attr("fill", function(d, i) { 
        if(i == 0) {
          return "#ff8383";
        } else if (i == 1) {
          return "#75d1ff";
        } else if (i == 2) {
          return amer_colors[3];
        } else if (i == 3) {
          return dem_colors[1];
        } else if (i == 4) {
          return prog12_colors[3];
        } else if (i == 5) {
          return prog24_colors[3];
        } else if (i == 6) {
          return sr_colors[3];
        }
      })
      .attr("d", function(d) {
        return arcInner(d);
      })
      .attr("transform", "translate(130, 120)")
      .each(function(d) { this._current = d; });


  vote_labels = vote_group.append("text")
    .attr("class", "textInner")
    .attr("transform", function(d) {
      var x = arcInner.centroid(d)[0] + 130;
      var y = arcInner.centroid(d)[1] + 120;
      return "translate(" + x + ", " + y + ")";
    })
    .attr("text-anchor", "middle")
    .text(function(d) {
      // return total electoral votes
      if(d.value > 0) {
        return d.value/1000000 + "M";
      }
    });


  // update if slices already exist
  ev_path = pres_svg.selectAll(".outer")
      .data(pie([gop_ev, dem_ev, amer_ev, badDem_ev, prog_ev, progTwo_ev, SR_ev]));

  ev_path
    .transition().duration(500).attrTween("d", arcTween);

  ev_text = pres_svg.selectAll(".textOuter")
      .data(pie([gop_ev, dem_ev, amer_ev, badDem_ev, prog_ev, progTwo_ev, SR_ev]));

  ev_text.transition().duration(500)
    .attr("transform", function(d) {
      var x = arc.centroid(d)[0] + 130;
      var y = arc.centroid(d)[1] + 120;
      return "translate(" + x + ", " + y + ")";
    })
    .text(function(d) {
      // return total electoral votes
      if(d.value > 0) {
        return d.value;
      }
    });;

  vote_path = pres_svg.selectAll(".inner")
      .data(pie([gop_votes, dem_votes, amer_votes,
                 badDem_votes, prog_votes, progTwo_votes, SR_votes]));

  vote_path
    .transition().duration(500).attrTween("d", arcTweenInner); 

  vote_text = pres_svg.selectAll(".textInner")
      .data(pie([gop_votes, dem_votes, amer_votes,
                 badDem_votes, prog_votes, progTwo_votes, SR_votes]));

  vote_text.transition().duration(500)
    .attr("transform", function(d) {
      var x = arcInner.centroid(d)[0] + 130;
      var y = arcInner.centroid(d)[1] + 120;
      return "translate(" + x + ", " + y + ")";
    })
    .text(function(d) {
      // return total electoral votes
      if(d.value > 0) {
        return (Math.round(((d.value/1000000) + 0.00001) * 100) / 100) + "M";
      }
    });; 

  
  //get state demographic data
  // var st_white = 0;
  // var st_black = 0;
  // var st_native = 0;
  // var st_asian = 0;
  // var st_pacific = 0;
  // var st_mult = 0;
  var prison = 0;
  var probation = 0;
  var parole = 0;
  var felon;
  var nonCit;
  var other;
  var prisonT; var probationT; var paroleT; var felonT; var nonCitT; var otherT;

  // updating values
  ELECGLOBAL.forEach(function(d) {
    // make sure all names line up between map json and data json
    if(d.year == CURRENT_YEAR && d.state == clickState) {
      // st_white = d.white;
      // st_black = d.black;
      // st_native = d.native;
      // st_asian = d.asian;
      // st_pacific = d.pacific;
      // st_mult = d.mult;
      // st_name = d.state;
      prison = d.prison;
      probation = d.probation;
      parole = d.parole;
      felon = d.felon;
      // unsure about the following 2 defns
      nonCit = d.pctNonCit * d.VAP
      other = d.VAP - nonCit - felon
    } else if (d.year == CURRENT_YEAR && d.state == "Totals") {
      prisonT = d.prison;
      probationT = d.probation;
      paroleT = d.parole;
      felonT = d.felon;
      // unsure about the following 2 defns
      nonCitT = d.pctNonCit * d.VAP
      otherT = d.VAP - nonCitT - felonT
    }
  })

  var all_states = []

  ELECGLOBAL.forEach(function(d) {
    if (d.year == 2012 && d.state != "Totals") {
      all_states.push(d.state)
    }
  })

  

  // select pie paths
  var elig_path = elig_svg.selectAll("#categ")
      .data(pie([nonCit, other, felon]));

  var elig_group = elig_path.enter().append("g");

  // add new slices for first time
  elig_group.append("path")
      .attr("id", "categ")
      .attr("fill", function(d, i) {
        return demo_scale(i);
      })
      .attr("d", function(d) {
        return arcDemo(d);
      })
      .attr("transform", "translate(130, 120)")
      .each(function(d) { this._current = d; });

  elig_labels = elig_group.append("text")
    .attr("class", "text")
    .attr("transform", function(d) {
      var x = arc.centroid(d)[0] + 130;
      var y = arc.centroid(d)[1] + 120;
      return "translate(" + x + ", " + y + ")";
    })
    .attr("text-anchor", "middle")
    .attr("fill", "white")
    .text(function(d) {
      // return total 
      if(d.value > 0) {
        return d.value;
      }
    });



  // select pie paths
  var elig2_path = elig2_svg.selectAll("#categ")
      .data(pie([nonCitT, otherT, felonT]));

  var elig2_group = elig2_path.enter().append("g");

  // add new slices for first time
  elig2_group.append("path")
      .attr("id", "categ")
      .attr("fill", function(d, i) {
        return demo_scale(i);
      })
      .attr("d", function(d) {
        return arcDemo(d);
      })
      .attr("transform", "translate(130, 120)")
      .each(function(d) { this._current = d; });

  var rounded = d3.format(".1")

  elig2_labels = elig2_group.append("text")
    .attr("class", "text")
    .attr("transform", function(d) {
      var x = arc.centroid(d)[0] + 130;
      var y = arc.centroid(d)[1] + 120;
      return "translate(" + x + ", " + y + ")";
    })
    .attr("text-anchor", "middle")
    .attr("fill", "white")
    .text(function(d) {
      // return total 
      if(d.value > 0) {
        return rounded((d.value/1000000).toFixed(1)) + "M";
      }
    });

  elig_svg.append("rect")
    .attr("x", 100)
    .attr("y", 225)
    .attr("width", 20)
    .attr("height", 20)
    .attr("fill", "#5C3D00")

  elig_svg.append("rect")
    .attr("x", 100)
    .attr("y", 250)
    .attr("width", 20)
    .attr("height", 20)
    .attr("fill", "#7A5200")

  elig_svg.append("rect")
    .attr("x", 100)
    .attr("y", 275)
    .attr("width", 20)
    .attr("height", 20)
    .attr("fill", "#A37519")

  elig_svg.append("text")
    .attr("x", 125)
    .attr("y", 235)
    // .style("text-anchor", "middle")
    .text("Ineligible");//citizen)");

  elig_svg.append("text")
    .attr("x", 125)
    .attr("y", 245)
    // .style("text-anchor", "middle")
    .text("(non-citizen)");

  elig_svg.append("text")
    .attr("x", 125)
    .attr("y", 265)
    // .style("text-anchor", "middle")
    .text("Voting-eligible");

  elig_svg.append("text")
    .attr("x", 125)
    .attr("y", 290)
    // .style("text-anchor", "middle")
    .text("Ineligible (felon)");

  // update if slices already exist

  var elig_path = elig_svg.selectAll("#categ")
      .data(pie([nonCit, other, felon]));

  elig_path
    .transition().duration(500)
    .attr("d", function(d) {
        return arcDemo(d);
      });

  elig_text = elig_svg.selectAll(".text")
      .data(pie([nonCit, other, felon]));

  var rounded = d3.format(".1")


  elig_text.transition().duration(500)
    .attr("transform", function(d) {
      var x = arc.centroid(d)[0] + 130;
      var y = arc.centroid(d)[1] + 120;
      return "translate(" + x + ", " + y + ")";
    })
    .text(function(d) {
      // return total 
      if(d.value > 0) {
        return rounded((d.value/1000000).toFixed(1)) + "M";
      }
    });;

  

  // select pie paths
  var demo_path = st_demo_svg.selectAll("#demographic")
      .data(pie([prison, probation, parole]));

  var demo_group = demo_path.enter().append("g");

  // add new slices for first time
  demo_group.append("path")
      .attr("id", "demographic")
      .attr("fill", function(d, i) {
        return demo_scale(i);
      })
      .attr("d", function(d) {
        return arcDemo(d);
      })
      .attr("transform", "translate(130, 120)")
      .each(function(d) { this._current = d; });

  demo_labels = demo_group.append("text")
    .attr("class", "text")
    .attr("transform", function(d) {
      var x = arc.centroid(d)[0] + 130;
      var y = arc.centroid(d)[1] + 120;
      return "translate(" + x + ", " + y + ")";
    })
    .attr("text-anchor", "middle")
    .attr("fill", "white")
    .text(function(d) {
      // return total 
      if(d.value > 0) {
        return d.value;
      }
    });

    // select pie paths
  var demo2_path = st_demo2_svg.selectAll("#demographic2")
      .data(pie([prisonT, probationT, paroleT]));

  var demo2_group = demo2_path.enter().append("g");

  // add new slices for first time
  demo2_group.append("path")
      .attr("id", "demographic2")
      .attr("fill", function(d, i) {
        return demo_scale(i);
      })
      .attr("d", function(d) {
        return arcDemo(d);
      })
      .attr("transform", "translate(130, 120)")
      .each(function(d) { this._current = d; });

  var comma = d3.format(",")

  demo2_labels = demo2_group.append("text")
    .attr("class", "text")
    .attr("transform", function(d) {
      var x = arc.centroid(d)[0] + 130;
      var y = arc.centroid(d)[1] + 120;
      return "translate(" + x + ", " + y + ")";
    })
    .attr("text-anchor", "middle")
    .attr("fill", "white")
    .text(function(d) {
      // return total 
      if(d.value > 0) {
        return comma(d.value);
      }
    });


// var st_demo_svg = d3.select("#stDemographic")
//   .append("svg")
//   .attr("width", getInnerWidth(d3.select("#stDemographic")))
//   .attr("height", 250);

  st_demo_svg.append("rect")
    .attr("x", 100)
    .attr("y", 225)
    .attr("width", 20)
    .attr("height", 20)
    .attr("fill", "#5C3D00")

  st_demo_svg.append("rect")
    .attr("x", 100)
    .attr("y", 250)
    .attr("width", 20)
    .attr("height", 20)
    .attr("fill", "#7A5200")

  st_demo_svg.append("rect")
    .attr("x", 100)
    .attr("y", 275)
    .attr("width", 20)
    .attr("height", 20)
    .attr("fill", "#A37519")

  st_demo_svg.append("text")
    .attr("x", 125)
    .attr("y", 240)
    // .style("text-anchor", "middle")
    .text("Prison");

  st_demo_svg.append("text")
    .attr("x", 125)
    .attr("y", 265)
    // .style("text-anchor", "middle")
    .text("Probation");

  st_demo_svg.append("text")
    .attr("x", 125)
    .attr("y", 290)
    // .style("text-anchor", "middle")
    .text("Parole");

  // update if slices already exist
  if (prison==0 && parole==0 && probation==0) {
    document.getElementById("noFelon").innerHTML = "N/A: felons are not ineligible, or data are not available.";
    document.getElementById("noFelon2").innerHTML = "";
  } else {
    document.getElementById("noFelon").innerHTML = "";
    document.getElementById("noFelon2").innerHTML = "";
  };

  st_demo_svg.append("text")
    .attr("x", 0)
    .attr("y", 230)
    .text("Breakdown of");

  st_demo_svg.append("text")
    .attr("x", 0)
    .attr("y", 240)
    .text("Ineligible");

  st_demo_svg.append("text")
    .attr("x", 0)
    .attr("y", 250)
    .text("Felons");

  elig_svg.append("text")
    .attr("x", 0)
    .attr("y", 230)
    .text("Breakdown of");

  elig_svg.append("text")
    .attr("x", 0)
    .attr("y", 240)
    .text("Voting-Age");

  elig_svg.append("text")
    .attr("x", 0)
    .attr("y", 250)
    .text("Population");

  var demo_path = st_demo_svg.selectAll("#demographic")
      .data(pie([prison, probation, parole]));

  demo_path
    .transition().duration(500)
    .attr("d", function(d) {
        return arcDemo(d);
      });

  demo_text = st_demo_svg.selectAll(".text")
      .data(pie([prison, probation, parole]));

  var comma = d3.format(",")

  demo_text.transition().duration(500)
    .attr("transform", function(d) {
      var x = arc.centroid(d)[0] + 130;
      var y = arc.centroid(d)[1] + 120;
      return "translate(" + x + ", " + y + ")";
    })
    .text(function(d) {
      // return total electoral votes
      if(d.value > 0) {
        return comma(d.value);
      }
    });;








  // prepare state-party line graph
  function isGood(obj) {
    return obj.state == clickState
  }

  function formatYear(year) {
    var year = year.toString();
    return year.charAt(2) + year.charAt(3)
  }

  var ELECFILTERED = ELECGLOBAL.filter(isGood);
  var ELEC_TOTALS = ELECGLOBAL.filter(function(obj) {return obj.state == "Totals"})

  var INCFILTERED = INCGLOBAL.filter(isGood);
  var INC_TOTALS = INCGLOBAL.filter(function(obj) {return obj.state == "Totals"})

  var stPartyHeight = 300;
  var stPartyWidth = (getInnerWidth(d3.select("#stParty")) - 55);
  var x = d3.scale.linear().range([35, stPartyWidth]);
  var y = d3.scale.linear().range([stPartyHeight, 0]);

  var years = []

  ELECFILTERED.forEach(function(d, i) {
    years[i] = d.year;
  })

  years.reverse();

  var xAxis = d3.svg.axis().scale(x)
    .tickFormat(function(d) {return formatYear(d)})
    .tickValues(years)
    .orient("bottom").ticks(5);

  var yAxis = d3.svg.axis().scale(y)
    .orient("left").ticks(5);

  var yAxisDot = d3.svg.axis().scale(y)
    .orient("left").ticks(0);

  var valueline = d3.svg.line()
    .x(function(d) {  {return x(d.year)}} )
    .y(function(d) {  {return y(d.demPct)}});
    
  var valueline2 = d3.svg.line()  
    .x(function(d) { return x(d.year)})
    .y(function(d) {  {return y(d.gopPct)}}); 

  var valueline3 = d3.svg.line()  
    .x(function(d) { return x(d.year)})
    .y(function(d) {  if (d.thirdName == "American Independent") {
      return y(d.thirdPct)
    } else {
      return y(0)
    }})

  var valueline4 = d3.svg.line()  
    .x(function(d) { return x(d.year)})
    .y(function(d) {  if (d.thirdName == "States' Rights") {
      return y(d.thirdPct)
    } else {
      return y(0)
    }})

  var valueline5 = d3.svg.line()  
    .x(function(d) { return x(d.year)})
    .y(function(d) {  if (d.thirdName == "Progressive (1924)") {
      return y(d.thirdPct)
    } else {
      return y(0)
    }})

  var valueline6 = d3.svg.line()  
    .x(function(d) { return x(d.year)})
    .y(function(d) {  if (d.thirdName == "Progressive (1912)") {
      return y(d.thirdPct)
    } else {
      return y(0) 
    }})


  // var valueline3 = d3.svg.line()
  //   .x(function(d) {  {return x(d.year)}} )
  //   .y(function(d) {  {return y(d.demPct)}});
    
  // var valueline4 = d3.svg.line()  
  //   .x(function(d) { return x(d.year)})
  //   .y(function(d) {  {return y(d.gopPct)}}); 

  d3.selectAll(".pathLine")
    .remove();

  d3.selectAll(".axis")
    .remove();

  x.domain(d3.extent(ELECFILTERED, function(d) { return d.year }));
  // y.domain([0, d3.max(ELECFILTERED, function(d) {
  //    return Math.max(d.gopPct, d.demPct, d.thirdPct)})]);
  y.domain([0, 100]); 

  st_party_svg.append("path")
    .attr("class", "pathLine")
    .attr("transform", "translate(0,5)")
    .attr("d", valueline(ELECFILTERED));
    
  st_party_svg.append("path")
    .style("stroke", "red")
    .attr("class", "pathLine")
    .attr("transform", "translate(0,5)")
    .attr("d", valueline2(ELECFILTERED));

  st_party_svg.append("path")
    .style("stroke", "purple")
    .attr("class", "pathLine")
    .attr("transform", "translate(0,5)")
    .attr("d", valueline3(ELECFILTERED));

  st_party_svg.append("path")
    .style("stroke", "orange")
    .attr("class", "pathLine")
    .attr("transform", "translate(0,5)")
    .attr("d", valueline4(ELECFILTERED));

  st_party_svg.append("path")
    .style("stroke", "green")
    .attr("class", "pathLine")
    .attr("transform", "translate(0,5)")
    .attr("d", valueline5(ELECFILTERED));

  st_party_svg.append("path")
    .style("stroke", "yellow")
    .attr("class", "pathLine")
    .attr("transform", "translate(0,5)")
    .attr("d", valueline6(ELECFILTERED));

  // st_party_svg.append("path")
  //   .style("stroke", "brown")
  //   .attr("class", "pathLine")
  //   .attr("d", valueline3(ELEC_TOTALS));

  // st_party_svg.append("path")
  //   .style("stroke", "purple")
  //   .attr("class", "pathLine")
  //   .attr("d", valueline4(ELEC_TOTALS));

  // if (CURRENT_YEAR == 1968) {
  //   var valueline3 = d3.svg.line()  
  //     .x(function(d) { return x(d.year)})
  //     .y(function(d) {  {return y(d.thirdPct)} });

  //   st_party_svg.append("path")
  //     .style("stroke", "purple")
  //     .attr("class", "pathLine")
  //     .attr("d", valueline3(ELECFILTERED));
  // }

  st_party_svg.append("g")          
    .attr("class", "axis")
    .attr("transform", "translate(0," + (stPartyHeight+5) + ")")
    .call(xAxis)
    .selectAll("text")
    // .attr("x", -12)
    // this is bad because labels don't line up with ticks
    // .attr("transform", "rotate(-70)");

  var margin_bottom = 50;
  var margin_left = 4;

  st_party_svg.append("text")      // text label for the x axis
    .attr("transform", "translate(" + (stPartyWidth / 2) + " ," + (stPartyHeight + margin_bottom) + ")")
    .style("text-anchor", "middle")
    .text("Year");

  st_party_svg.append("text")
    .attr("transform", "rotate(-90)")
    .attr("y", (0 - margin_left))
    .attr("x",0 - (stPartyHeight / 2))
    .attr("dy", "1em")
    .style("text-anchor", "middle")
    .text("Percentage of Popular Vote");

  st_party_svg.append("g")
    .attr("class", "axis")
    .attr("transform", "translate(35,5)")
    .call(yAxis); 

  // st_party_svg.append("g")
  //   .attr("class", "dotAxis")
  //   .attr("class", "axis")
  //   .attr("transform", "translate(" + (35 + 4.5 * (CURRENT_YEAR - 1912)) + ",0)")
  //   .style("stroke-dasharray", ("3, 3"))
  //   .call(yAxisDot); 

  // stTurnt
  // may actually be more useful to just have this shit on the same graph
  var stTurntHeight = 300;
  var stTurntWidth = (getInnerWidth(d3.select("#stTurnt")) - 55);

  var xTurnt = d3.scale.linear().range([35, stTurntWidth]);
  var yTurnt = d3.scale.linear().range([stTurntHeight, 0]);

  var yearsTurnt = []
  tickYear = 1980;
  while (tickYear <= 2012) {
    yearsTurnt.push(tickYear)
    tickYear += 4
  }

  var xAxisTurnt = d3.svg.axis().scale(xTurnt)
    .tickFormat(function(d) {return formatYear(d)})
    .tickValues(yearsTurnt)
    .orient("bottom").ticks(5);

  var yAxisTurnt = d3.svg.axis().scale(yTurnt)
    .tickFormat(function(d) {return d*100})
    .orient("left").ticks(5);

  var valuelineTurnt = d3.svg.line()
    .x(function(d, i) { if (d.year > 1979) { {return xTurnt(d.year)}}} )
    .y(function(d) { if (d.year > 1979) {return yTurnt(d.turntA)}});
    
  var valuelineTurnt2 = d3.svg.line()  
    .x(function(d, i) {if (d.year > 1979) { return xTurnt(d.year)}})
    .y(function(d) { if (d.year > 1979) {return yTurnt(d.turntE)}}); 

  var valuelineTurnt3 = d3.svg.line()  
    .x(function(d, i) {if (d.year > 1979) { return xTurnt(d.year)}})
    .y(function(d) { if (d.year > 1979) {return yTurnt(d.turntE)}}); 

  var valuelineTurnt4 = d3.svg.line()  
    .x(function(d, i) {if (d.year > 1979) { return xTurnt(d.year)}})
    .y(function(d) { if (d.year > 1979) {return yTurnt(d.turntA)}}); 

  xTurnt.domain([1980, 2012]);
  yTurnt.domain([0, 1])

  st_turnt_svg.append("path")
    .attr("class", "pathLine")
    .style("stroke", "green")
    .style("stroke-dasharray", ("3, 3"))
    .attr("d", valuelineTurnt(ELECFILTERED));

  st_turnt_svg.append("path")
    .attr("class", "pathLine")
    .style("stroke", "green")
    .attr("d", valuelineTurnt2(ELECFILTERED));

  st_turnt_svg.append("path")
    .attr("class", "pathLine")
    .style("stroke", "purple")
    .attr("d", valuelineTurnt3(ELEC_TOTALS));

  st_turnt_svg.append("path")
    .attr("class", "pathLine")
    .style("stroke", "purple")
    .style("stroke-dasharray", ("3, 3"))
    .attr("d", valuelineTurnt4(ELEC_TOTALS));

  st_turnt_svg.append("g")          
    .attr("class", "axis")
    .attr("transform", "translate(0," + (stTurntHeight+10) + ")")
    .call(xAxisTurnt)
    .selectAll("text")
    // .attr("x", -12)
    // .attr("transform", "rotate(-70)");

  st_turnt_svg.append("g")
    .attr("class", "axis")
    .attr("transform", "translate(35,10)")
    .call(yAxisTurnt); 

  st_turnt_svg.append("rect")
    .attr("x", stTurntWidth - 250)
    .attr("y", 360)
    .attr("width", 240)
    .attr("height", 80)
    .attr("fill", "gray")
    .attr("fill-opacity", .3);

  var legLen = 66;
  var legLenD = 87;

  st_turnt_svg.append("line")
    .attr("x1", stTurntWidth - 195)
    .attr("y1", 400)
    .attr("x2", function() {return this.x1.baseVal.value+legLen})
    .attr("y2", function() {return this.y1.baseVal.value})
    .attr("stroke", "green")
    .style("stroke-dasharray", ("3, 3"))
    .attr("stroke-width", 5)

  st_turnt_svg.append("line")
    .attr("x1", stTurntWidth - 110)
    .attr("y1", 400)
    .attr("x2", function() {return this.x1.baseVal.value+legLenD})
    .attr("y2", function() {return this.y1.baseVal.value})
    .attr("stroke", "green")
    .attr("stroke-width", 5)

  st_turnt_svg.append("line")
    .attr("x1", stTurntWidth - 195)
    .attr("y1", 420)
    .attr("x2", function() {return this.x1.baseVal.value+legLen})
    .attr("y2", function() {return this.y1.baseVal.value})
    .attr("stroke", "purple")
    .style("stroke-dasharray", ("3, 3"))
    .attr("stroke-width", 5)

  st_turnt_svg.append("line")
    .attr("x1", stTurntWidth - 110)
    .attr("y1", 420)
    .attr("x2", function() {return this.x1.baseVal.value+legLenD})
    .attr("y2", function() {return this.y1.baseVal.value})
    .attr("stroke", "purple")
    .attr("stroke-width", 5)

  st_turnt_svg.append("text")
    .attr("x", stTurntWidth - 195)
    .attr("y", 375)
    // .style("text-anchor", "middle")
    .text("Voting-age"); 

  st_turnt_svg.append("text")
    .attr("x", stTurntWidth - 195)
    .attr("y", 385)
    // .style("text-anchor", "middle")
    .text("population"); 

  st_turnt_svg.append("text")
    .attr("x", stTurntWidth - 110)
    .attr("y", 375)
    // .style("text-anchor", "middle")
    .text("Voting-eligible");

  st_turnt_svg.append("text")
    .attr("x", stTurntWidth - 110)
    .attr("y", 385)
    // .style("text-anchor", "middle")
    .text("population");

  st_turnt_svg.append("text")
    .attr("x", stTurntWidth - 245)
    .attr("y", 405)
    // .style("text-anchor", "middle")
    .text("State");

  st_turnt_svg.append("text")
    .attr("x", stTurntWidth - 245)
    .attr("y", 425)
    // .style("text-anchor", "middle")
    .text("Nation");

  var margin_bottom = 50;
  var margin_left = 4;

  st_turnt_svg.append("text")      // text label for the x axis
    .attr("transform", "translate(" + (stTurntWidth / 2) + " ," + (stTurntHeight + margin_bottom) + ")")
    .style("text-anchor", "middle")
    .text("Year");

  st_turnt_svg.append("text")
    .attr("transform", "rotate(-90)")
    .attr("y", (0 - margin_left))
    .attr("x",0 - (stTurntHeight / 2))
    .attr("dy", "1em")
    .style("text-anchor", "middle")
    .text("Percentage of VAP or VEP");

  //
  //
  //
  // income
  var stIncHeight = 300;
  var stIncWidth = (getInnerWidth(d3.select("#stInc")) - 55);

  var xInc = d3.scale.linear().range([35, stIncWidth]);
  var yInc = d3.scale.linear().range([stIncHeight, 0]);

  var yearsInc = []
  tickYear = 1984;
  while (tickYear <= 2012) {
    yearsInc.push(tickYear)
    tickYear += 1
  }

  var xAxisInc = d3.svg.axis().scale(xInc)
    .tickFormat(function(d) {return formatYear(d)})
    .tickValues(yearsInc)
    .orient("bottom").ticks(5);

  var yAxisInc = d3.svg.axis().scale(yInc)
    .tickFormat(function(d) {return d})
    .orient("left").ticks(5);

  var valuelineInc = d3.svg.line()
    .x(function(d, i) { if (d.year >= 1984) { {return xInc(d.year)}}} )
    .y(function(d) { if (d.year >= 1984) {;return yInc(d.medInc)}});
    
  var valuelineInc2 = d3.svg.line()  
    .x(function(d, i) {if (d.year >= 1984) { return xInc(d.year)}})
    .y(function(d) { if (d.year >= 1984) {return yInc(d.medInc)}}); 

  xInc.domain([1984, 2012]);
  yInc.domain([0, 80000])

  st_inc_svg.append("path")
    .attr("class", "pathLine")
    .style("stroke", "green")
    .attr("transform", "translate(40,0)")
    .attr("d", valuelineInc(INCFILTERED));

  st_inc_svg.append("path")
    .attr("class", "pathLine")
    .style("stroke", "purple")
    .attr("transform", "translate(40,0)")
    .attr("d", valuelineInc2(INC_TOTALS));

  
  st_inc_svg.append("g")          
    .attr("class", "axis")
    .attr("transform", "translate(40," + (stIncHeight+10) + ")")
    .call(xAxisInc)
    // .selectAll("text")
    // .attr("x", -12)
    // .attr("transform", "rotate(-70)");

  st_inc_svg.append("g")
    .attr("class", "axis")
    .attr("transform", "translate(75,10)")
    .call(yAxisInc); 

  var margin_bottom = 50;
  var margin_left = 3;

  st_inc_svg.append("text")      // text label for the x axis
    .attr("transform", "translate(" + (stIncWidth / 2) + " ," + (stIncHeight + margin_bottom) + ")")
    .style("text-anchor", "middle")
    .text("Year");

  st_inc_svg.append("text")
    .attr("transform", "rotate(-90)")
    .attr("y", (0 - margin_left))
    .attr("x",0 - (stIncHeight / 2))
    .attr("dy", "1em")
    .style("text-anchor", "middle")
    .text("Median Household Income (USD)");

  st_inc_svg.append("rect")
    .attr("x", stIncWidth - 60)
    .attr("y", 225)
    .attr("width", 20)
    .attr("height", 20)
    .attr("fill", "green")

  st_inc_svg.append("rect")
    .attr("x", stIncWidth - 60)
    .attr("y", 250)
    .attr("width", 20)
    .attr("height", 20)
    .attr("fill", "purple")

  st_inc_svg.append("text")
    .attr("x", stIncWidth - 35)
    .attr("y", 240)
    // .style("text-anchor", "middle")
    .text("State");

  st_inc_svg.append("text")
    .attr("x", stIncWidth - 35)
    .attr("y", 265)
    // .style("text-anchor", "middle")
    .text("Nation");


  // state comparison to nation view
  var comp_filtered = ELECGLOBAL.filter(function(d) {
    return d.year == CURRENT_YEAR;
  });

  comp_filtered.sort(function(a, b) {
    var a_margin = a.demPct - a.gopPct;
    var b_margin = b.demPct - b.gopPct;

    if(a_margin > b_margin) {
      return 1;
    } else {
      return -1;
    } 
  });

  var stCompHeight = 300;
  var stCompWidth = (getInnerWidth(d3.select("#stCompare")) - 25);

  var xComp = d3.scale.linear().range([45, stCompWidth]);
  var yComp = d3.scale.linear().range([stCompHeight, 0]);

  var yearsComp = []
    tickYear = 1980;
    while (tickYear <= 2012) {
      yearsComp.push(tickYear)
      tickYear += 4
    }

  var xAxisComp = d3.svg.axis().scale(xComp)
    .tickFormat(function(d) {return formatYear(d); })
    .tickValues([])
    .orient("bottom").ticks(0);

  var yAxisComp = d3.svg.axis().scale(yComp)
    .tickFormat(function(d) {return d*100})
    .orient("left").ticks(5);

  xComp.domain([1980, 2012]);
  yComp.domain([0, 1]);

  st_comp_svg.append("g")         
    .attr("class", "axis")
    .attr("transform", "translate(0," + (stCompHeight+10) + ")")
    .call(xAxisComp);

  st_comp_svg.append("g")
    .attr("class", "axis")
    .attr("transform", "translate(45,10)")
    .call(yAxisComp);

  st_comp_svg.append("text")
    .attr("transform", "rotate(-90)")
    .attr("y", (0))
    .attr("x",0 - (stCompHeight / 2))
    .attr("dy", "1em")
    .style("text-anchor", "middle")
    .text("Percent Margin of Victory");

  st_comp_svg.append("text")      // text label for the x axis
    .attr("transform", "translate(" + (stCompWidth / 2) + " ," + (stCompHeight + 30) + ")")
    .style("text-anchor", "middle")
    .text("Each bar represents a state");

  st_comp_svg.append("text")      // text label for the x axis
    .attr("transform", "translate(" + (stCompWidth / 2) + " ," + (stCompHeight + 45) + ")")
    .style("text-anchor", "middle")
    .text("Highlighted bar represents the selected state");

  var comp_width = 4;

  var comp_bars = st_comp_svg.selectAll("rect")
    .data(comp_filtered);

  comp_bars.enter().append("rect")
    .attr("x", function(d, i) {
      return i * (comp_width + 2) + 45;
    })
    .attr("y", function(d) {
      return yComp(Math.abs(d.gopPct - d.demPct)/100);
    })
    .attr("width", comp_width)
    .attr("height", function(d) {
      return stCompHeight + 10 - yComp(Math.abs(d.gopPct - d.demPct)/100);
    })
    .attr("fill", function(d) {
      if(d.gopPct > d.demPct) {
        if(d.state == clickState) {
          return gop_colors[3];
        } else {
          return gop_colors[0];
        }
      } else {
        if(d.state == clickState) {
          return dem_colors[3];
        } else {
          return dem_colors[0];
        }
      }
    });

  // comp_bars.enter().append("text")
  //   .text("test")
  //   .attr("x", function(d, i) {
  //     return i * (comp_width + 2) + 35;
  //   })
  //   .attr("y", function(d) {
  //     return stCompHeight + 30;
  //   })
    // .attr("transform", "rotate(90)");

  comp_bars = st_comp_svg.selectAll("rect")
    .data(comp_filtered);

  var getMargin = function(d) {
    var margin = 0;
    var party = "";

    if(d.thirdPct != null) {
      if(d.thirdPct > d.gopPct && d.thirdPct > d.demPct) {
        party = d.thirdName;
      } else if(d.gopPct > d.demPct) {
        party = "gop";
      } else {
        party = "dem";
      }

      var sorted = [d.gopPct, d.demPct, d.thirdPct].sort(function (a, b) {
        if(a < b) {
          return 1;
        } else {
          return -1;
        }
      });
      margin = (sorted[0] - sorted[1])/100;
    } else {
      if(d.gopPct > d.demPct) {
        party = "gop";
      } else {
        party = "dem";
      }
      margin = Math.abs(d.gopPct - d.demPct)/100;
    }

    return [margin, party];
  };

  comp_bars.transition().duration(500)
    .attr("x", function(d, i) {
      return i * (comp_width + 2) + 45;
    })
    .attr("y", function(d) {
      return yComp(getMargin(d)[0]);
    })
    .attr("width", comp_width)
    .attr("height", function(d) {
      return stCompHeight + 10 - yComp(getMargin(d)[0]);
    })
    .attr("fill", function(d) {
      
      var winner = getMargin(d)[1];

      if(winner == "gop") {
        if(d.state == clickState) {
          return gop_colors[3];
        } else {
          return gop_colors[0];
        }
      } else if(winner == "dem") {
        if(d.state == clickState) {
          return dem_colors[3];
        } else {
          return dem_colors[0];
        }
      } else if(winner == "States' Rights") {
        if(d.state == clickState) {
          return sr_colors[3];
        } else {
          return sr_colors[0];
        }
      } else if(winner == "Progressive (1924)") {
        if(d.state == clickState) {
          return prog24_colors[3];
        } else {
          return prog24_colors[0];
        }
      } else if(winner == "Progressive (1912)") {
        if(d.state == clickState) {
          return prog12_colors[3];
        } else {
          return prog12_colors[0];
        }
      } else if(winner == "American Independent") {
        if(d.state == clickState) {
          return am_colors[3];
        } else {
          return am_colors[0];
        }
    }
    });

  comp_bars.exit().remove();

 


  // update choropleth
  var state_paths = states.selectAll("path");
  var state_pattern_path = state_pattern.selectAll("path");
  var state_text = states.selectAll("text");
  
  function update(clickState) {
    document.getElementById("dropState").value = clickState;
    document.getElementsByClassName('clickState')[0].innerHTML = clickState;
      document.getElementsByClassName('clickState')[1].innerHTML = clickState;
      document.getElementsByClassName('clickState')[2].innerHTML = clickState;
      document.getElementsByClassName('clickState')[3].innerHTML = clickState;
      document.getElementsByClassName('clickState')[4].innerHTML = clickState;
      document.getElementsByClassName('clickState')[5].innerHTML = clickState;
      updateVis();
  }

  // Get dropdown element from DOM
  var dropdown = document.getElementById("dropState");

  // Loop through the array
  for (var i = 0; i < all_states.length; ++i) {
    // Append the element to the end of Array list
    dropdown[dropdown.length] = new Option(all_states[i], all_states[i]);
  }

  d3.selectAll("#dropState")
  .on("change", function() {
    d3.selectAll("option").each(function(d) {
      if(d3.select(this).property('selected')) {
        clickState = this.value;
        update(clickState);
      }
  })})

  state_paths
    .on("click", function() {
      clickState = this.id;
      update(clickState);
    })
    .style('cursor', 'pointer')
    .on("mouseenter", function(d) {
      var that = this;

      var this_ev = 0;
      var this_pct_dem = 0;
      var this_pct_gop = 0;
      var this_pct_third = 0;

      ELECGLOBAL.forEach(function(d) {
        if(d.state == that.id && d.year == CURRENT_YEAR){
          this_ev = d.gopEV + d.demEV + d.thirdEV;
          this_pct_dem = d.demPct;
          this_pct_gop = d.gopPct;
          this_pct_third = d.thirdPct;
        }
      })

      var tip = choro_svg.append("g")
          .attr("id", "toolTip");

      tip.append("rect")
        .attr("x", function(d) {
          return d3.mouse(this)[0] - 30;
        })
        .attr("y", function(d) {
          return d3.mouse(this)[1] - 90;
        })
        .attr("width", 125)
        .attr("height", 80)
        .attr("fill", "black")
        .attr("fill-opacity", .75);

      tip.append("text")
        .text(function() {
          return that.id;
        })
        .attr("text-decoration", "underline")
        .attr("fill", "white")
        .attr("x", function(d) {
          return d3.mouse(this)[0] - 25;
        })
        .attr("y", function(d) {
          return d3.mouse(this)[1] - 75;
        });

      tip.append("text")
        .text("Electoral Votes: " + this_ev)
        .attr("fill", "white")
        .attr("x", function(d) {
          return d3.mouse(this)[0] - 25;
        })
        .attr("y", function(d) {
          return d3.mouse(this)[1] - 58;
        });

      tip.append("text")
        .text("Democrat: " + this_pct_dem + "%")
        .attr("fill", "white")
        .attr("x", function(d) {
          return d3.mouse(this)[0] - 25;
        })
        .attr("y", function(d) {
          return d3.mouse(this)[1] - 44;
        });

      tip.append("text")
        .text("Republican: " + this_pct_gop + "%")
        .attr("fill", "white")
        .attr("x", function(d) {
          return d3.mouse(this)[0] - 25;
        })
        .attr("y", function(d) {
          return d3.mouse(this)[1] - 30;
        });

      if(this_pct_third != null) {
        tip.append("text")
          .text("3rd Party: " + this_pct_third + "%")
          .attr("fill", "white")
          .attr("x", function(d) {
            return d3.mouse(this)[0] - 25;
          })
          .attr("y", function(d) {
            return d3.mouse(this)[1] - 15;
          });
      }
    })
    .on("mouseleave", function(d) {
      d3.select("#toolTip").remove();
    });



  state_text
    .style('cursor', 'pointer')
    .on("mouseenter", function(d) {
      var that = this;

      var this_ev = 0;
      var this_pct_dem = 0;
      var this_pct_gop = 0;
      var this_pct_third = 0;
      var this_name = "";

      ELECGLOBAL.forEach(function(d) {
        if((d.state + "txt") == that.id && d.year == CURRENT_YEAR){
          this_ev = d.gopEV + d.demEV + d.thirdEV;
          this_pct_dem = d.demPct;
          this_pct_gop = d.gopPct;
          this_pct_third = d.thirdPct;
          this_name = d.state;
        }
      })

      var tip = choro_svg.append("g")
          .attr("id", "toolTip");

      tip.append("rect")
        .attr("x", function(d) {
          return d3.mouse(this)[0] - 30;
        })
        .attr("y", function(d) {
          return d3.mouse(this)[1] - 90;
        })
        .attr("width", 125)
        .attr("height", 80)
        .attr("fill", "black")
        .attr("fill-opacity", .75);

      tip.append("text")
        .text(this_name)
        .attr("text-decoration", "underline")
        .attr("fill", "white")
        .attr("x", function(d) {
          return d3.mouse(this)[0] - 25;
        })
        .attr("y", function(d) {
          return d3.mouse(this)[1] - 75;
        });

      tip.append("text")
        .text("Electoral Votes: " + this_ev)
        .attr("fill", "white")
        .attr("x", function(d) {
          return d3.mouse(this)[0] - 25;
        })
        .attr("y", function(d) {
          return d3.mouse(this)[1] - 58;
        });

      tip.append("text")
        .text("Democrat: " + this_pct_dem + "%")
        .attr("fill", "white")
        .attr("x", function(d) {
          return d3.mouse(this)[0] - 25;
        })
        .attr("y", function(d) {
          return d3.mouse(this)[1] - 44;
        });

      tip.append("text")
        .text("Republican: " + this_pct_gop + "%")
        .attr("fill", "white")
        .attr("x", function(d) {
          return d3.mouse(this)[0] - 25;
        })
        .attr("y", function(d) {
          return d3.mouse(this)[1] - 30;
        });

      if(this_pct_third != null) {
        tip.append("text")
          .text("3rd Party: " + this_pct_third + "%")
          .attr("fill", "white")
          .attr("x", function(d) {
            return d3.mouse(this)[0] - 25;
          })
          .attr("y", function(d) {
            return d3.mouse(this)[1] - 15;
          });
      }
    })
    .on("mouseleave", function(d) {
      d3.select("#toolTip").remove();
    });

  state_pattern_path.transition().duration(500)
    // .attr("fill", "url(#vertical-stripe-1)");
    // .attr("fill-opacity", .5)
    .attr("fill", function() {
      if (this.id == dem_home && this.id == gop_home) {
        return "url(#ladder-stripe-1)"
      } else if (this.id == gop_home) {
        return "url(#horizontal-stripe-1)"
      } else if (this.id == dem_home) {
        return "url(#vertical-stripe-1)"
      } else if (this.id == third_home) {
        return "url(#diagonal-stripe-1)"
      } else {
        return "white"
      }
    })
    .attr("fill-opacity", function() {
      if (this.id != dem_home && this.id != gop_home && this.id != third_home) {
        return 0
      } else {
        return 1
      }
    });
    
  state_paths.transition().duration(500)
    .attr("fill", function() { 
    var that = this;
    var noodle = "cat";
    var current_states_obj = ELECGLOBAL.filter(function(obj) {
      return obj.year == CURRENT_YEAR
    })
    var current_states_str = []
    current_states_obj.forEach(function(d) {
      current_states_str.push(d.name)
    })
    if (!(this.id in current_states_str)) {
      noodle = "gray"
    }
    ELECGLOBAL.forEach(function(d) {
      if(d.year == CURRENT_YEAR && d.state == that.id) {
        // if there is a third party 
        if (d.thirdPct !== null) {
          // if the third party loses the state
          if (d.thirdPct < d.demPct || d.thirdPct < d.gopPct) {
            noodle = quantize(Math.max(d.thirdPct,d.demPct) - Math.max(d.thirdPct, d.gopPct));
          // if the third party wins the state
          } else {
            // what if third party is just always purple?
            if (third_name == "Democratic") {
              // blue, but with distinction from main blue
              var quantizeThird = d3.scale.quantize()
                .domain([0, 20])
                .range(["#335CAD","#1947A3","#003399","#002E8A"]);
            } else if (third_name == "American Independent") {
              // purple
              var quantizeThird = d3.scale.quantize()
                .domain([0, 20])
                .range(amer_colors);
            } else if (third_name == "Progressive (1912)") {
              // orange
              var quantizeThird = d3.scale.quantize()
                .domain([0, 20])
                .range(prog12_colors);
            } else if (third_name == "Progressive (1924)") {
              // green
              var quantizeThird = d3.scale.quantize()
                .domain([0, 20])
                .range(prog24_colors);
            } else if (third_name == "States' Rights") {
              // brown
              var quantizeThird = d3.scale.quantize()
                .domain([0, 20])
                .range(sr_colors);
            }
            noodle = quantizeThird(d.thirdPct - Math.max(d.demPct, d.gopPct));
          }
        // if there is no third party
        } else {
          noodle = quantize(d.demPct - d.gopPct);
        }
      } 
    })
    return noodle;
     
    })
    .attr("fill-opacity", .85)
    // .attr("class", "circles-1");
    // .attr("fill-opacity", .5)
    // .attr("fill", "url(#verticall-stripe-1) blue")
    // .attr("fill", dem_colors[1]);
    
    // state_paths.transition(5000)
    //   .attr("fill", "url(#vertical-stripe-1) blue");

  state_text.transition().duration(500)
    .text(function() {
      var that = this;
      var noodle = "";
      ELECGLOBAL.forEach(function(d) {
        if(d.year == CURRENT_YEAR && d.state.concat("txt") == that.id) {
          var total_ev = d.demEV + d.gopEV + d.thirdEV;
          // console.log(total_ev.toString());
          noodle = total_ev.toString();
        }
      })
      return noodle;
    })
    .attr("fill", "black");
};



// initializes the visualization
var initVis = function (error, stateJson, elecData, incData) {
  // assign election data global
  ELECGLOBAL = elecData
  INCGLOBAL = incData;

  // draw states
  state_pattern.selectAll("path")
    .data(stateJson.features)
    .enter().append("path")
    .attr("id", function(d) { return d.properties.NAME; })
    .attr("d", path)
    .attr("fill", "white")

  states.selectAll("path")
    .data(stateJson.features)
    .enter().append("path")
    .attr("id", function(d) { return d.properties.NAME; })
    .attr("d", path)
    .attr("fill", function(d) { if(d.properties.CENSUSAREA > 113590) {
        return "#AAAAAA"; 
      } else {
        return "#AAAAAA";
      }
      })
    .attr("fill-opacity", .5)
    .attr("stroke", "#555555")
    .attr("stroke-width", 1.5)

  states.selectAll("text")
    .data(stateJson.features)
    .enter().append("svg:text")
    .text(function(d) { return ""; })
    .attr("x", function(d) { return path.centroid(d)[0]; })
    .attr("y", function(d) { return path.centroid(d)[1]; })
    .attr("text-anchor", "middle")
    .attr("font-weight", "bold")
    .attr("id", function(d) { return d.properties.NAME.concat("txt"); }); 




  // load in our central election data file
  updateVis()
};

// loads data and then calls visualization-drawing function
var startHere = function () {
  queue()
    .defer(d3.json, "data/us_states_small.json")
    .defer(d3.json, "data/jsonMain.json")
    .defer(d3.json, "data/medInc.json")
    .await(initVis);
};

startHere()

</script>
</body>
</html>